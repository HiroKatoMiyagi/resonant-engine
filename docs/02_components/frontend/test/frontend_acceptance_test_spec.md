# Frontend Core Features 受け入れテスト仕様書

## 1. テスト概要

### 1.1 目的
Frontend Core Features Implementationの機能完全性、正確性、ユーザビリティを検証する。

### 1.2 テスト範囲
- Phase 1: 矛盾検出UI
- Phase 2: WebSocket統合
- Phase 3: Dashboard Analytics
- Phase 4: Choice Preservation UI
- Phase 5: Re-evaluation UI

### 1.3 テスト環境
- ローカル開発環境: `npm run dev` (`http://localhost:5173`)
- バックエンド: `http://localhost:8000`
- ブラウザ: Chrome最新版、Firefox最新版

---

## 2. Phase 1: 矛盾検出UI テスト

### 2.1 基本表示テスト

#### FE-P1-001: 矛盾検出ダッシュボード表示
**目的**: 矛盾検出ダッシュボードが正常に表示されることを検証
**前提条件**: バックエンドに矛盾データが存在する

**手順**:
1. `http://localhost:5173/contradictions` にアクセス
2. ページタイトル「矛盾検出ダッシュボード」が表示されることを確認
3. グリッド3列レイアウトで矛盾アイテムが表示されることを確認

**期待結果**:
- [ ] タイトル「矛盾検出ダッシュボード」が表示される
- [ ] グリッドレイアウト（3列）が正常に動作する
- [ ] 各矛盾アイテムが適切に表示される

#### FE-P1-002: 矛盾レベル色分け表示
**目的**: 矛盾レベルに応じた色分けが正常に動作することを検証

**手順**:
1. error レベル矛盾の確認
   - 枠線が `border-red-500` (赤色) であることを確認
   - 背景が `bg-red-50` (薄い赤) であることを確認
2. warning レベル矛盾の確認
   - 枠線が `border-yellow-500` (黄色) であることを確認
   - 背景が `bg-yellow-50` (薄い黄) であることを確認
3. info レベル矛盾の確認
   - 枠線が `border-blue-500` (青色) であることを確認
   - 背景が `bg-blue-50` (薄い青) であることを確認

**期待結果**:
- [ ] Error レベル: 赤色枠・薄い赤背景
- [ ] Warning レベル: 黄色枠・薄い黄背景
- [ ] Info レベル: 青色枠・薄い青背景

#### FE-P1-003: 矛盾データ表示内容
**目的**: 各矛盾アイテムで必要な情報が正しく表示されることを検証

**手順**:
各矛盾アイテムで以下の情報が表示されることを確認
1. レベル表示（ERROR/WARNING/INFO）
2. 作成日時表示（日本語形式）
3. メッセージ内容表示
4. 解決ステータス（解決済み/未解決）
5. 信頼度スコア表示（存在する場合）

**期待結果**:
- [ ] レベルが大文字で表示される（ERROR/WARNING/INFO）
- [ ] 作成日時が日本語形式（YYYY/MM/DD）で表示される
- [ ] メッセージ内容が適切に改行・表示される
- [ ] 解決ステータスが緑（解決済み）または赤（未解決）で表示される
- [ ] 信頼度スコアが存在する場合、パーセンテージで表示される

### 2.2 API統合テスト

#### FE-P1-004: API正常応答時の動作
**目的**: バックエンドAPIが正常応答する場合の動作を検証

**手順**:
1. ブラウザのNetwork タブを開く
2. ページを再読み込み
3. `/api/contradictions/` への GET リクエストを確認
4. レスポンスデータが正しく画面に反映されることを確認

**期待結果**:
- [ ] GET `/api/contradictions/` リクエストが送信される
- [ ] レスポンスステータスが200である
- [ ] レスポンスデータが画面に正しく表示される
- [ ] 5秒間隔で自動更新される（ポーリング）

#### FE-P1-005: API エラー時の動作
**目的**: バックエンドAPIでエラーが発生した場合の動作を検証

**手順**:
1. バックエンドサーバーを停止
2. フロントエンドページにアクセス
3. エラーメッセージの表示を確認
4. バックエンドサーバーを再起動
5. 自動復旧することを確認

**期待結果**:
- [ ] 適切なエラーメッセージが表示される（「エラーが発生しました。バックエンドAPIの接続を確認してください。」）
- [ ] アプリケーションがクラッシュしない
- [ ] サーバー復旧後、自動的にデータが表示される

#### FE-P1-006: データ無し時の動作
**目的**: バックエンドから空配列が返される場合の動作を検証

**手順**:
1. バックエンドのcontradictionデータを全削除（または空の配列を返すよう設定）
2. ページを再読み込み
3. 空状態メッセージの表示を確認

**期待結果**:
- [ ] 「現在、検出された矛盾はありません。」メッセージが表示される
- [ ] エラーが発生しない
- [ ] レイアウトが崩れない

### 2.3 ナビゲーション・ルーティングテスト

#### FE-P1-007: ナビゲーションリンク
**目的**: ナビゲーションからの遷移が正常に動作することを検証

**手順**:
1. ホームページにアクセス
2. ナビゲーションメニューに「矛盾検出」リンクが存在することを確認
3. 「矛盾検出」リンクをクリック
4. 矛盾検出ダッシュボードページに遷移することを確認
5. ブラウザの戻るボタンで戻ることを確認

**期待結果**:
- [ ] ナビゲーションに「矛盾検出」リンクが表示される
- [ ] リンククリックで `/contradictions` に遷移する
- [ ] 戻るボタンで前のページに戻る
- [ ] URLが正しく変更される

---

## 3. Phase 2: WebSocket統合テスト

### 3.1 WebSocket接続テスト

#### FE-P2-001: WebSocket接続確立
**目的**: WebSocket接続が正常に確立されることを検証
**前提条件**: バックエンドでWebSocketサーバーが起動している

**手順**:
1. ブラウザの開発者ツール > Network > WS タブを開く
2. アプリケーションにアクセス
3. WebSocket接続が確立されることを確認
4. 接続状態を画面で確認

**期待結果**:
- [ ] WebSocket接続が `ws://localhost:8000/ws` に確立される
- [ ] 接続ステータスが「接続済み」と表示される
- [ ] 接続エラーが発生しない

#### FE-P2-002: リアルタイム更新
**目的**: WebSocketによるリアルタイム更新が動作することを検証

**手順**:
1. 矛盾検出ダッシュボードを開く
2. 別のタブでバックエンドから新しい矛盾データを作成
3. WebSocketイベント受信を確認
4. 画面が自動更新されることを確認

**期待結果**:
- [ ] 新しい矛盾データが自動的に画面に表示される
- [ ] ページリロードが不要である
- [ ] 更新が即座（1秒以内）に反映される

### 3.2 フォールバック機能テスト

#### FE-P2-003: WebSocket切断時のフォールバック
**目的**: WebSocket切断時にポーリングにフォールバックすることを検証

**手順**:
1. WebSocket接続確立後、バックエンドのWebSocketサーバーを一時停止
2. 接続切断の検出を確認
3. ポーリングモードに切り替わることを確認
4. WebSocketサーバー再起動後、再接続することを確認

**期待結果**:
- [ ] WebSocket切断が検出される
- [ ] 自動的にポーリングモード（5秒間隔）に切り替わる
- [ ] データ取得が継続される
- [ ] WebSocket復旧後、再接続される

---

## 4. Phase 3: Dashboard Analytics テスト

### 4.1 システムメトリクス表示テスト

#### FE-P3-001: システムメトリクス基本表示
**目的**: システムメトリクスが正常に表示されることを検証

**手順**:
1. `/dashboard` または `/analytics` ページにアクセス
2. システムメトリクス各項目が表示されることを確認

**期待結果**:
- [ ] Messages総数が表示される
- [ ] Intents総数が表示される
- [ ] 矛盾検出数が表示される
- [ ] Crisis Index（0-100）が表示される
- [ ] システム稼働率が表示される

#### FE-P3-002: Crisis Index 表示
**目的**: Crisis Indexが適切に可視化されることを検証

**手順**:
1. Crisis Indexの数値を確認
2. 数値に応じた色分け表示を確認
3. 危険レベルの表示を確認

**期待結果**:
- [ ] Crisis Index値（0-100）が数値で表示される
- [ ] 70未満: 緑色（正常）
- [ ] 70-85: 黄色（警告）
- [ ] 85以上: 赤色（危険）
- [ ] プログレスバーまたはゲージで視覚化される

---

## 5. パフォーマンステスト

### 5.1 初期表示速度テスト

#### FE-P5-001: 初期表示パフォーマンス
**目的**: 各ページの初期表示が要件内で完了することを検証

**手順**:
1. ブラウザの Performance タブを開く
2. キャッシュクリア後、各ページにアクセス
3. First Contentful Paint (FCP) を測定
4. Largest Contentful Paint (LCP) を測定

**期待結果**:
- [ ] 矛盾検出ダッシュボード: FCP < 1.5秒, LCP < 3秒
- [ ] Dashboard Analytics: FCP < 1.5秒, LCP < 3秒
- [ ] 全ページ: 初期表示 < 3秒

### 5.2 メモリ使用量テスト

#### FE-P5-002: メモリ使用量監視
**目的**: アプリケーションのメモリ使用量が要件内であることを検証

**手順**:
1. ブラウザのMemory タブを開く
2. 各ページを順次アクセス
3. 長時間の使用をシミュレーション（30分間）
4. メモリリークがないことを確認

**期待結果**:
- [ ] 初期メモリ使用量 < 30MB
- [ ] 30分使用後のメモリ使用量 < 50MB
- [ ] 明らかなメモリリークが発生しない

---

## 6. ユーザビリティテスト

### 6.1 視覚的デザインテスト

#### FE-U1-001: デザイン一貫性
**目的**: デザインが一貫しており、ユーザビリティが確保されていることを検証

**手順**:
1. 各ページのフォント・色・スペーシングを確認
2. レスポンシブデザインの動作確認
3. アクセシビリティの基本確認

**期待結果**:
- [ ] フォント: Inter, 14px base が使用されている
- [ ] Tailwindの標準スペーシング（p-4, m-2等）が使用されている
- [ ] 色の使い分けが適切（エラー=赤、警告=黄、情報=青）
- [ ] モバイルサイズでも表示が崩れない

### 6.2 エラー状態の表示

#### FE-U1-002: エラー状態のユーザビリティ
**目的**: エラー状態が分かりやすく表示されることを検証

**手順**:
1. 各種エラー状態を意図的に発生させる
2. エラーメッセージの内容・表示位置を確認
3. エラー解消後の動作を確認

**期待結果**:
- [ ] エラーメッセージが分かりやすい日本語で表示される
- [ ] エラー状態でもアプリケーションが操作可能である
- [ ] エラー解消後、自動的に正常状態に戻る

---

## 7. 受け入れ基準

### 7.1 Phase 1 (矛盾検出UI) 受け入れ基準
**必須基準**:
- [ ] 全 7 テストケースが通過する (FE-P1-001 ～ FE-P1-007)
- [ ] グリッド3列レイアウトが正常動作する
- [ ] 矛盾レベル別の色分けが正確である
- [ ] API統合が完全に動作する
- [ ] エラーハンドリングが適切である

**品質基準**:
- [ ] 初期表示速度 < 3秒
- [ ] メモリ使用量 < 30MB
- [ ] Chrome・Firefox両方で動作する

### 7.2 Phase 2 (WebSocket統合) 受け入れ基準
**必須基準**:
- [ ] WebSocket接続が正常確立する
- [ ] リアルタイム更新が動作する
- [ ] フォールバック機能が動作する

### 7.3 Phase 3 (Dashboard Analytics) 受け入れ基準
**必須基準**:
- [ ] システムメトリクス表示が正常動作する
- [ ] Crisis Index可視化が適切である

### 7.4 総合受け入れ基準
**Phase 1 必須完了条件**:
- Phase 1の全テストがPASS
- 既存機能（Messages, Intents, Specifications, Notifications）に影響がない
- バックエンドAPI仕様に完全準拠

**Phase 2-3 推奨完了条件**:
- WebSocket統合によるパフォーマンス向上確認
- Dashboard Analyticsによるシステム可視化実現

---

## 8. テスト実行手順

### 8.1 環境準備

```bash
# フロントエンド起動
cd frontend
npm install
npm run dev

# バックエンド起動（別ターミナル）
cd backend
python -m uvicorn app.main:app --reload

# WebSocketテスト用（Phase 2）
# WebSocketサーバーが起動していることを確認
curl -I http://localhost:8000/ws
```

### 8.2 手動テスト実行

```bash
# Phase 1: 基本機能テスト
1. http://localhost:5173/contradictions にアクセス
2. Network タブで API リクエスト確認
3. 各テストケースを順次実行

# Phase 2: WebSocket テスト
1. ws://localhost:8000/ws 接続確認
2. リアルタイム更新テスト
3. 切断・再接続テスト

# Phase 3: Analytics テスト
1. システムメトリクス表示確認
2. Crisis Index 可視化確認
```

### 8.3 自動テスト実行（推奨）

```bash
# Unit テスト
npm run test

# E2E テスト（Playwright使用時）
npm run test:e2e

# カバレッジ付きテスト
npm run test:coverage
```

---

## 9. 問題発生時の対処

### 9.1 よくある問題と解決方法

| 問題 | 原因 | 解決方法 |
|-----|------|---------|
| 矛盾データが表示されない | バックエンドAPIエラー | `curl http://localhost:8000/api/contradictions/` で確認 |
| CSS色分けが効かない | Tailwind設定問題 | `npm run build-css` でTailwind再コンパイル |
| WebSocket接続失敗 | サーバー未起動 | WebSocketサーバー起動確認 |
| TypeScriptエラー | 型定義不正 | `npm run type-check` で詳細確認 |

### 9.2 エスカレーション基準

以下の場合はテスト中断し、開発チームへエスカレーション:
- Phase 1の必須テストケースが50%以上失敗
- アプリケーションがクラッシュして復旧しない
- API統合で継続的にエラーが発生
- メモリリークが明らかに発生している

---

**テスト実施責任者**: フロントエンド開発チーム
**作成者**: Claude Sonnet 4 (Kana)
**作成日**: 2025-11-24
**バージョン**: 1.0