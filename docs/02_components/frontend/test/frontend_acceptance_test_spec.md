# Frontend Sprint 14-15 受け入れテスト仕様書

**Sprint**: 14-15
**作成日**: 2025-11-24
**バージョン**: 1.1（API仕様修正版）
**対象**: Resonant Engine Frontend

---

## ⚠️ テスト実施上の注意（総合テストv3.7からの教訓）

### テスト実施者への警告

| 過去の問題 | 対策 |
|-----------|------|
| テストのハードコードスキップ | `@pytest.mark.skipif` のみ許可。理由なしスキップ禁止 |
| 環境未確認でのテスト実行 | 事前に環境確認コマンドを実行すること |
| API仕様の誤解 | 本仕様書のエンドポイントを正確に使用 |

### テスト失敗時の対応フロー

```
テスト失敗
    ↓
原因確認: エラーメッセージを確認
    ↓
┌─ APIエラー → バックエンド起動確認
├─ 型エラー → 型定義と実際のレスポンスを比較
├─ UI不一致 → 仕様書のCSS class指定を確認
└─ 接続エラー → 環境変数確認
    ↓
修正して再テスト
```

---

## 1. テスト概要

### 1.1 目的
Frontend Core Features実装の機能完全性、正確性、ユーザビリティを検証する。

### 1.2 テスト環境

| 項目 | 設定 |
|-----|------|
| フロントエンド | `http://localhost:5173` |
| Dashboard Backend | `http://localhost:8000` |
| Bridge API | `http://localhost:8000/api/v1/` |
| ブラウザ | Chrome最新版、Firefox最新版 |

### 1.3 事前確認コマンド

```bash
# 1. フロントエンド起動確認
curl -I http://localhost:5173

# 2. Dashboard Backend確認
curl http://localhost:8000/health

# 3. Bridge API確認（矛盾検出エンドポイント）
curl -I http://localhost:8000/api/v1/contradiction/pending
```

---

## 2. Phase 1: 矛盾検出UI テスト

### 2.1 基本表示テスト

#### FE-P1-001: 矛盾検出ダッシュボード表示

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P1-001 |
| **目的** | 矛盾検出ダッシュボードが正常に表示されることを検証 |
| **前提条件** | バックエンド起動済み |

**手順**:
1. `http://localhost:5173/contradictions` にアクセス
2. ページタイトル「矛盾検出ダッシュボード」が表示されることを確認
3. レイアウトが仕様通りであることを確認

**期待結果**:
- [ ] タイトル「矛盾検出ダッシュボード」が表示される
- [ ] グリッドレイアウト（レスポンシブ: 1/2/3列）が動作する
- [ ] ローディング状態が表示される（データ取得中）

#### FE-P1-002: 矛盾タイプ別色分け表示

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P1-002 |
| **目的** | 矛盾タイプに応じた色分けが正常に動作することを検証 |

**確認項目（仕様書通りの色）**:

| contradiction_type | 枠線クラス | 背景クラス |
|-------------------|-----------|-----------|
| `tech_stack` | `border-red-500` | `bg-red-50` |
| `policy_shift` | `border-orange-500` | `bg-orange-50` |
| `duplicate` | `border-yellow-500` | `bg-yellow-50` |
| `dogma` | `border-blue-500` | `bg-blue-50` |

**手順**:
1. 各タイプの矛盾データを用意（バックエンドまたはモック）
2. ブラウザの開発者ツールでCSSクラスを確認
3. 視覚的に色が正しいことを確認

**期待結果**:
- [ ] tech_stack: 赤色枠・薄い赤背景
- [ ] policy_shift: オレンジ色枠・薄いオレンジ背景
- [ ] duplicate: 黄色枠・薄い黄背景
- [ ] dogma: 青色枠・薄い青背景

#### FE-P1-003: 矛盾データ表示内容

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P1-003 |
| **目的** | 矛盾アイテムで必要な情報が正しく表示されることを検証 |

**確認項目（バックエンドスキーマに対応）**:

| 表示項目 | 対応フィールド | 形式 |
|---------|---------------|------|
| タイプラベル | contradiction_type | 日本語変換 |
| 検出日時 | detected_at | YYYY/MM/DD形式 |
| 内容 | new_intent_content | テキスト |
| 信頼度 | confidence_score | パーセント表示 |
| ステータス | resolution_status | バッジ表示 |

**期待結果**:
- [ ] タイプラベルが日本語で表示される
- [ ] 検出日時が日本語形式で表示される
- [ ] 信頼度がパーセントで表示される（例: 85%）
- [ ] 信頼度バーが正しい幅で表示される
- [ ] ステータスバッジが色分けされて表示される

### 2.2 API統合テスト

#### FE-P1-004: API正常応答時の動作

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P1-004 |
| **目的** | Bridge APIが正常応答する場合の動作を検証 |

**確認するAPIエンドポイント**:
```
GET /api/v1/contradiction/pending?user_id=xxx
```

**手順**:
1. ブラウザのNetwork タブを開く
2. ページを再読み込み
3. `/api/v1/contradiction/pending` への GET リクエストを確認
4. レスポンスデータが正しく画面に反映されることを確認

**期待結果**:
- [ ] GET `/api/v1/contradiction/pending` リクエストが送信される
- [ ] クエリパラメータ `user_id` が含まれる
- [ ] レスポンスステータスが200である
- [ ] レスポンスデータが画面に正しく表示される
- [ ] 5秒間隔で自動更新される（ポーリング）

#### FE-P1-005: APIエラー時の動作

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P1-005 |
| **目的** | Bridge APIでエラーが発生した場合の動作を検証 |

**手順**:
1. バックエンドサーバーを停止
2. フロントエンドページにアクセス
3. エラーメッセージの表示を確認
4. バックエンドサーバーを再起動
5. 自動復旧することを確認

**期待結果**:
- [ ] エラーメッセージが表示される
- [ ] アプリケーションがクラッシュしない
- [ ] サーバー復旧後、自動的にデータが表示される

#### FE-P1-006: データなし時の動作

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P1-006 |
| **目的** | 矛盾データが0件の場合の動作を検証 |

**手順**:
1. バックエンドから空のレスポンス `{"contradictions": [], "total": 0}` が返るよう設定
2. ページを再読み込み
3. 空状態メッセージの表示を確認

**期待結果**:
- [ ] 「現在、検出された矛盾はありません。」メッセージが表示される
- [ ] エラーが発生しない
- [ ] レイアウトが崩れない

### 2.3 ナビゲーション・ルーティングテスト

#### FE-P1-007: ナビゲーションリンク

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P1-007 |
| **目的** | ナビゲーションからの遷移が正常に動作することを検証 |

**手順**:
1. ホームページにアクセス
2. ナビゲーションメニューに「矛盾検出」リンクが存在することを確認
3. 「矛盾検出」リンクをクリック
4. 矛盾検出ダッシュボードページに遷移することを確認
5. ブラウザの戻るボタンで戻ることを確認

**期待結果**:
- [ ] ナビゲーションに「矛盾検出」リンクが表示される
- [ ] リンククリックで `/contradictions` に遷移する
- [ ] 戻るボタンで前のページに戻る
- [ ] URLが正しく変更される

### 2.4 既存機能への影響テスト

#### FE-P1-008: 既存ページ動作確認

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P1-008 |
| **目的** | 既存ページが正常に動作することを検証 |

**確認対象ページ**:
- `/messages` - メッセージ一覧
- `/intents` - Intent一覧
- `/specifications` - 仕様書一覧

**手順**:
1. 各ページにアクセス
2. 基本機能が動作することを確認
3. エラーが発生しないことを確認

**期待結果**:
- [ ] Messages ページが正常動作
- [ ] Intents ページが正常動作
- [ ] Specifications ページが正常動作
- [ ] コンソールにエラーが出力されない

---

## 3. Phase 2: WebSocket統合テスト

### 3.1 WebSocket接続テスト

#### FE-P2-001: WebSocket接続確立

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P2-001 |
| **目的** | WebSocket接続が正常に確立されることを検証 |
| **前提条件** | バックエンドでWebSocketサーバーが起動している |

**WebSocket URL**: `ws://localhost:8000/ws/intents`

**手順**:
1. ブラウザの開発者ツール > Network > WS タブを開く
2. アプリケーションにアクセス
3. WebSocket接続が確立されることを確認

**期待結果**:
- [ ] WebSocket接続が確立される
- [ ] 接続ステータスが「open」である
- [ ] 接続エラーが発生しない

#### FE-P2-002: リアルタイム更新

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P2-002 |
| **目的** | WebSocketによるリアルタイム更新が動作することを検証 |

**手順**:
1. 矛盾検出ダッシュボードを開く
2. 別のタブでバックエンドから新しい矛盾データを作成
3. WebSocketイベント受信を確認
4. 画面が自動更新されることを確認

**期待結果**:
- [ ] 新しい矛盾データが自動的に画面に表示される
- [ ] ページリロードが不要である
- [ ] 更新が即座（1秒以内）に反映される

#### FE-P2-003: WebSocket切断時のフォールバック

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P2-003 |
| **目的** | WebSocket切断時にポーリングにフォールバックすることを検証 |

**手順**:
1. WebSocket接続確立後、バックエンドのWebSocketサーバーを一時停止
2. 接続切断の検出を確認
3. ポーリングモードに切り替わることを確認
4. WebSocketサーバー再起動後、再接続することを確認

**期待結果**:
- [ ] WebSocket切断が検出される
- [ ] 自動的にポーリングモード（5秒間隔）に切り替わる
- [ ] データ取得が継続される
- [ ] WebSocket復旧後、再接続される

---

## 4. Phase 3: Dashboard Analytics テスト

### 4.1 システムメトリクス表示テスト

#### FE-P3-001: システムメトリクス基本表示

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P3-001 |
| **目的** | システムメトリクスが正常に表示されることを検証 |

**確認API**: `GET /api/v1/dashboard/overview`

**表示項目**:
- Messages総数
- Intents総数
- アクティブセッション数
- 未解決矛盾数
- Crisis Index（0-100）

**期待結果**:
- [ ] 各メトリクスが数値で表示される
- [ ] Crisis Indexが0-100の範囲で表示される
- [ ] 最終更新時刻が表示される

#### FE-P3-002: Crisis Index 色分け表示

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-P3-002 |
| **目的** | Crisis Indexが適切に色分け表示されることを検証 |

**色分け仕様**:

| Crisis Index | 色 | 状態 |
|--------------|-----|------|
| 0-69 | `text-green-600` | 正常 |
| 70-84 | `text-yellow-600` | 警告（pre-crisis） |
| 85-100 | `text-red-600` | 危機（crisis） |

**期待結果**:
- [ ] 0-69: 緑色で表示
- [ ] 70-84: 黄色で表示
- [ ] 85-100: 赤色で表示

---

## 5. パフォーマンステスト

### 5.1 初期表示速度テスト

#### FE-PERF-001: 初期表示パフォーマンス

| 項目 | 内容 |
|-----|------|
| **テストID** | FE-PERF-001 |
| **目的** | 各ページの初期表示が要件内で完了することを検証 |

**手順**:
1. ブラウザの Performance タブを開く
2. キャッシュクリア後、各ページにアクセス
3. First Contentful Paint (FCP) を測定
4. Largest Contentful Paint (LCP) を測定

**要件**:
| 項目 | 要件 |
|-----|------|
| 初期表示 | < 3秒 |
| API応答 | < 2秒 |
| WebSocket接続 | < 1秒 |

**期待結果**:
- [ ] 矛盾検出ダッシュボード: LCP < 3秒
- [ ] Dashboard Analytics: LCP < 3秒

---

## 6. 受け入れ基準

### 6.1 Phase 1 (矛盾検出UI) 受け入れ基準

**必須基準**:
- [ ] 全8テストケースがPASS (FE-P1-001 ～ FE-P1-008)
- [ ] グリッドレイアウトが正常動作する
- [ ] 矛盾タイプ別の色分けが正確である
- [ ] API統合が完全に動作する
- [ ] 既存機能に影響がない

**品質基準**:
- [ ] 初期表示速度 < 3秒
- [ ] Chrome・Firefox両方で動作する

### 6.2 Phase 2 (WebSocket統合) 受け入れ基準

**必須基準**:
- [ ] 全3テストケースがPASS (FE-P2-001 ～ FE-P2-003)
- [ ] WebSocket接続が正常確立する
- [ ] リアルタイム更新が動作する
- [ ] フォールバック機能が動作する

### 6.3 Phase 3 (Dashboard Analytics) 受け入れ基準

**必須基準**:
- [ ] 全2テストケースがPASS (FE-P3-001 ～ FE-P3-002)
- [ ] システムメトリクス表示が正常動作する
- [ ] Crisis Index色分けが適切である

### 6.4 総合受け入れ基準

**Phase 1 必須完了条件**:
- Phase 1の全テストがPASS
- 既存機能（Messages, Intents, Specifications）に影響がない
- `npm run build` エラーなし

---

## 7. テスト実行手順

### 7.1 環境準備

```bash
# 1. フロントエンド起動
cd frontend
npm install
npm run dev

# 2. バックエンド起動（別ターミナル）
# Dashboard Backend
cd backend
python -m uvicorn app.main:app --reload --port 8000

# 3. Bridge API起動（必要な場合）
# ※ 同一ポートで動作する場合は不要
```

### 7.2 手動テスト実行

```bash
# Phase 1: 基本機能テスト
1. http://localhost:5173/contradictions にアクセス
2. Network タブで API リクエスト確認
3. 各テストケースを順次実行

# Phase 2: WebSocket テスト
1. Network > WS タブで接続確認
2. リアルタイム更新テスト
3. 切断・再接続テスト

# Phase 3: Analytics テスト
1. システムメトリクス表示確認
2. Crisis Index 色分け確認
```

---

## 8. 問題発生時の対処

### 8.1 よくある問題と解決方法

| 問題 | 原因 | 解決方法 |
|-----|------|---------|
| 矛盾データが表示されない | Bridge APIエラー | `curl http://localhost:8000/api/v1/contradiction/pending` で確認 |
| 404エラー | エンドポイント間違い | 仕様書のAPI一覧を確認 |
| 型エラー | 型定義不一致 | バックエンドスキーマと比較 |
| CSS色分けが効かない | Tailwind設定問題 | `npm run build` でTailwind再コンパイル |
| WebSocket接続失敗 | サーバー未起動 | WebSocketサーバー起動確認 |

### 8.2 エスカレーション基準

以下の場合はテスト中断し、開発チームへエスカレーション:
- Phase 1の必須テストケースが50%以上失敗
- アプリケーションがクラッシュして復旧しない
- API統合で継続的にエラーが発生
- 既存機能が破壊されている

---

**テスト実施責任者**: フロントエンド開発チーム
**作成者**: Claude Code
**レビュー日**: 2025-11-24
**バージョン**: 1.1（API仕様修正版）
