# Resonant Engine フロントエンド総合テスト仕様書

**作成日**: 2025-11-24
**バージョン**: 1.0（Frontend Core Features対応版）
**対象環境**: 開発環境（React + TypeScript）
**テスト種別**: フロントエンドシステムテスト / 統合テスト

---

## ⚠️ 重要事項（MUST READ FIRST）

### 絶対遵守事項（MUST）

1. **テストは必ずローカル開発環境で実行すること**
   ```bash
   # フロントエンド起動
   cd frontend && npm run dev

   # バックエンド起動（別ターミナル）
   cd backend && uvicorn app.main:app --reload
   ```

2. **バックエンドAPIが起動していることを確認すること**
   - `http://localhost:8000/health` でヘルスチェック
   - 必要なマイグレーションが適用済みであること

3. **ブラウザは最新版Chrome/Firefoxを使用すること**
   - 開発者ツールを活用してNetwork、Console、Performance監視

4. **段階的テスト実行を行うこと**
   - Phase 1 → Phase 2 → Phase 3の順序厳守
   - Phase完了前に次に進まない

### 禁止事項（MUST NOT）

| 禁止事項 | 理由 |
|---------|------|
| テストの安易なスキップ | 機能不全の見落としを防ぐため |
| 異なるブラウザでの混在テスト | 結果の一貫性確保のため |
| バックエンド未起動でのテスト実行 | 不正確な結果を避けるため |
| Phase順序の無視 | 依存関係のあるテストの整合性のため |

---

## 📋 変更履歴

### v1.0 変更点（2025-11-24）

**Frontend Core Features Implementation対応:**

フロントエンドの実装率35% → 100%を目指す包括的テスト仕様。

**対象機能**:
- Phase 1: 矛盾検出UI（最重要）
- Phase 2: WebSocket統合（効率化）
- Phase 3: Dashboard Analytics（可視化）
- Phase 4: Choice Preservation UI（選択肢管理）
- Phase 5: Re-evaluation UI（AI修正フィードバック）

**テスト戦略**:
- 既存機能（Messages, Intents, Specifications, Notifications）の回帰テスト
- 新機能の段階的検証
- バックエンドとの完全統合確認

---

## 目次

1. [テスト概要](#1-テスト概要)
2. [テスト環境](#2-テスト環境)
3. [前提条件](#3-前提条件)
4. [Phase 1: 矛盾検出UI テスト](#4-phase-1-矛盾検出ui-テスト)
5. [Phase 2: WebSocket統合テスト](#5-phase-2-websocket統合テスト)
6. [Phase 3: Dashboard Analytics テスト](#6-phase-3-dashboard-analytics-テスト)
7. [回帰テスト](#7-回帰テスト)
8. [パフォーマンステスト](#8-パフォーマンステスト)
9. [エラー対処チェックリスト](#9-エラー対処チェックリスト)
10. [合否判定基準](#10-合否判定基準)

---

## 1. テスト概要

### 1.1 目的

本総合テストは、Resonant EngineのReact フロントエンドが期待通りに動作することを検証する。
**モックを使用せず**、実際のバックエンドAPIと統合した状態で、
ユーザー体験とシステム統合動作を確認する。

### 1.2 テスト範囲

| カテゴリ | 対象機能 | 優先度 |
|---------|---------|-------|
| **Phase 1** | 矛盾検出UI | 最高（必須） |
| **Phase 2** | WebSocket統合・リアルタイム通信 | 高（重要） |
| **Phase 3** | Dashboard Analytics・システム可視化 | 高（重要） |
| **Phase 4** | Choice Preservation UI | 中（推奨） |
| **Phase 5** | Re-evaluation UI | 中（推奨） |
| **回帰テスト** | 既存機能の動作確認 | 最高（必須） |

### 1.3 テスト対象外

- バックエンドAPI自体のテスト（別仕様書で実施）
- 本番環境での動作確認
- 負荷テスト、セキュリティテスト

---

## 2. テスト環境

### 2.1 システム構成

```
┌─────────────────────────────────────────────────────────────┐
│ ローカル開発環境                                              │
├─────────────────────────────────────────────────────────────┤
│ フロントエンド │ React 18 + TypeScript + Vite │ :5173      │
│ バックエンド   │ FastAPI + Python             │ :8000      │
│ データベース   │ PostgreSQL (Docker)          │ :5432      │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 技術スタック

```typescript
// フロントエンド技術スタック
{
  "framework": "React 18",
  "language": "TypeScript",
  "build": "Vite",
  "styling": "Tailwind CSS",
  "data": "React Query v4",
  "http": "Axios",
  "routing": "React Router"
}
```

### 2.3 ネットワーク構成

```
フロントエンド (localhost:5173)
       ↓ HTTP/WebSocket
バックエンド (localhost:8000)
       ↓ PostgreSQL Protocol
データベース (localhost:5432)
```

---

## 3. 前提条件

### 3.1 環境準備チェックリスト

実行前に以下を確認すること：

- [ ] Node.js (v16以上) がインストールされている
- [ ] npm または yarn がインストールされている
- [ ] Docker / Docker Composeがインストールされている
- [ ] バックエンドAPI (`http://localhost:8000`) が起動している
- [ ] PostgreSQLデータベースが起動している
- [ ] 必要なマイグレーションが適用されている

### 3.2 起動手順

```bash
# Step 1: バックエンド・データベース起動
cd docker
docker-compose up -d

# Step 2: バックエンド起動確認
curl http://localhost:8000/health
# 期待される出力: {"status":"healthy"}

# Step 3: フロントエンド依存関係インストール
cd ../frontend
npm install

# Step 4: フロントエンド起動
npm run dev
# アクセス: http://localhost:5173
```

### 3.3 テストデータ準備

矛盾検出UIテストに必要な基本データ:

```bash
# バックエンド経由でテストデータ作成
curl -X POST http://localhost:8000/api/contradictions/ \
  -H "Content-Type: application/json" \
  -d '{
    "level": "error",
    "message": "テスト用エラーレベル矛盾",
    "confidence_score": 0.95
  }'

curl -X POST http://localhost:8000/api/contradictions/ \
  -H "Content-Type: application/json" \
  -d '{
    "level": "warning",
    "message": "テスト用警告レベル矛盾",
    "confidence_score": 0.75
  }'

curl -X POST http://localhost:8000/api/contradictions/ \
  -H "Content-Type: application/json" \
  -d '{
    "level": "info",
    "message": "テスト用情報レベル矛盾",
    "confidence_score": 0.60
  }'
```

---

## 4. Phase 1: 矛盾検出UI テスト

### 4.1 基本表示テスト

#### FT-P1-001: 矛盾検出ダッシュボードアクセス
**目的**: 矛盾検出ダッシュボードに正常にアクセスできることを検証

**手順**:
1. ブラウザで `http://localhost:5173` にアクセス
2. ナビゲーションメニューから「矛盾検出」をクリック
3. URLが `http://localhost:5173/contradictions` に変わることを確認
4. ページタイトル「矛盾検出ダッシュボード」が表示されることを確認

**期待結果**:
- [ ] ナビゲーションリンクが存在し、クリック可能
- [ ] 正しいURLに遷移する
- [ ] ページタイトルが表示される
- [ ] レイアウトが崩れていない

#### FT-P1-002: グリッドレイアウト表示
**目的**: 矛盾アイテムが3列グリッドで表示されることを検証

**手順**:
1. 矛盾検出ダッシュボードにアクセス
2. 矛盾アイテムの表示を確認
3. レスポンシブデザインの確認（ブラウザ幅を変更）

**期待結果**:
- [ ] デスクトップ表示で3列グリッドが表示される
- [ ] 各矛盾アイテムが適切にスペーシングされている
- [ ] タブレット・モバイルサイズでレスポンシブ対応されている
- [ ] アイテム間の余白が適切（gap-4）

#### FT-P1-003: 矛盾レベル別色分け
**目的**: 矛盾レベル（error/warning/info）に応じた色分けが正常に表示されることを検証

**手順**:
1. error レベル矛盾の色確認
   - 枠線: `border-red-500`（赤色）
   - 背景: `bg-red-50`（薄い赤）
   - テキスト: `text-red-800`（濃い赤）
2. warning レベル矛盾の色確認
   - 枠線: `border-yellow-500`（黄色）
   - 背景: `bg-yellow-50`（薄い黄）
   - テキスト: `text-yellow-800`（濃い黄）
3. info レベル矛盾の色確認
   - 枠線: `border-blue-500`（青色）
   - 背景: `bg-blue-50`（薄い青）
   - テキスト: `text-blue-800`（濃い青）

**期待結果**:
- [ ] Error: 赤色系での適切な色分け
- [ ] Warning: 黄色系での適切な色分け
- [ ] Info: 青色系での適切な色分け
- [ ] 色のコントラストが十分で視認性が良い

### 4.2 データ表示テスト

#### FT-P1-004: 矛盾データ内容表示
**目的**: 各矛盾アイテムで必要な情報が正しく表示されることを検証

**手順**:
1. 各矛盾アイテムの表示内容を確認
   - レベル表示（ERROR/WARNING/INFO）
   - 作成日時（日本語形式: YYYY/MM/DD）
   - メッセージ内容
   - 解決ステータス（解決済み/未解決）
   - 信頼度スコア（存在する場合、パーセンテージ表示）

**期待結果**:
- [ ] レベルが大文字で表示される（ERROR/WARNING/INFO）
- [ ] 作成日時が日本語ロケールで表示される
- [ ] メッセージ内容が適切に表示・改行される
- [ ] 解決ステータスがバッジ形式で表示される（緑: 解決済み、赤: 未解決）
- [ ] 信頼度スコアが「信頼度: XX%」形式で表示される

#### FT-P1-005: 空データ状態
**目的**: 矛盾データが存在しない場合の表示を検証

**手順**:
1. バックエンドから全ての矛盾データを削除
2. ページを再読み込み
3. 空状態メッセージの表示を確認

**期待結果**:
- [ ] 「現在、検出された矛盾はありません。」メッセージが中央に表示される
- [ ] エラーが発生しない
- [ ] レイアウトが適切に表示される

### 4.3 API統合テスト

#### FT-P1-006: API正常応答処理
**目的**: バックエンドAPIとの正常な統合を検証

**手順**:
1. ブラウザ開発者ツールのNetworkタブを開く
2. 矛盾検出ダッシュボードにアクセス
3. API リクエストを監視
4. レスポンスの確認

**期待結果**:
- [ ] `GET /api/contradictions/` リクエストが送信される
- [ ] レスポンスステータスが200 OK
- [ ] レスポンスが正しいJSON形式
- [ ] データが画面に正確に反映される
- [ ] 5秒間隔でポーリングリクエストが送信される（Phase 2でWebSocketに切り替え予定）

#### FT-P1-007: API エラーハンドリング
**目的**: API エラー時の適切なハンドリングを検証

**手順**:
1. バックエンドサーバーを停止
2. 矛盾検出ダッシュボードにアクセス
3. エラー表示を確認
4. バックエンド再起動後の復旧を確認

**期待結果**:
- [ ] 分かりやすいエラーメッセージが表示される
- [ ] アプリケーションがクラッシュしない
- [ ] サーバー復旧後、自動的にデータが表示される
- [ ] ユーザーが再読み込み操作を行えばデータが取得される

---

## 5. Phase 2: WebSocket統合テスト

### 5.1 WebSocket接続テスト

#### FT-P2-001: WebSocket接続確立
**目的**: WebSocket接続が正常に確立されることを検証
**前提条件**: バックエンドでWebSocketエンドポイント(`/ws`)が実装されている

**手順**:
1. ブラウザ開発者ツールのNetwork → WS タブを開く
2. アプリケーションにアクセス
3. WebSocket接続の確立を確認
4. 接続状態の監視

**期待結果**:
- [ ] `ws://localhost:8000/ws` への接続が確立される
- [ ] 接続ステータスが「Connected」になる
- [ ] 接続エラーが発生しない
- [ ] 適切なハンドシェイクが完了する

#### FT-P2-002: リアルタイム更新確認
**目的**: WebSocket経由でリアルタイム更新が動作することを検証

**手順**:
1. 矛盾検出ダッシュボードを開く
2. 別ブラウザタブまたはAPI クライアントで新しい矛盾データを作成
3. 元のタブでリアルタイム更新を確認

**期待結果**:
- [ ] 新しいデータが自動的に画面に表示される
- [ ] ページリロードが不要
- [ ] 更新が即座（1-2秒以内）に反映される
- [ ] 既存データが保持される

### 5.2 WebSocket切断・再接続テスト

#### FT-P2-003: 接続切断時の動作
**目的**: WebSocket切断時のフォールバック動作を検証

**手順**:
1. WebSocket接続確立後、ネットワーク接続を一時的に無効化
2. 切断検知の確認
3. 接続復旧時の再接続確認

**期待結果**:
- [ ] 接続切断が適切に検知される
- [ ] ポーリングモードに自動的にフォールバック
- [ ] データ取得が継続される
- [ ] 接続復旧後、WebSocketに再接続される

---

## 6. Phase 3: Dashboard Analytics テスト

### 6.1 システムメトリクス表示テスト

#### FT-P3-001: ダッシュボード基本表示
**目的**: Dashboard Analyticsページが正常に表示されることを検証
**前提条件**: `/dashboard` または `/analytics` ルートが実装されている

**手順**:
1. ナビゲーションから「ダッシュボード」にアクセス
2. システムメトリクス各項目の表示確認
3. データの正確性確認

**期待結果**:
- [ ] Messages総数が表示される
- [ ] Intents総数が表示される
- [ ] 矛盾検出数が表示される
- [ ] Crisis Index (0-100) が表示される
- [ ] システム稼働率が表示される
- [ ] 各メトリクスが数値として正確に表示される

#### FT-P3-002: Crisis Index可視化
**目的**: Crisis Indexが適切に可視化されることを検証

**手順**:
1. Crisis Indexの数値表示確認
2. 危険レベルに応じた色分け確認
3. 視覚的表現（プログレスバー/ゲージ）確認

**期待結果**:
- [ ] Crisis Index値（0-100）が数値で表示される
- [ ] 危険レベル別の色分け
  - 0-69: 緑色（正常）
  - 70-84: 黄色（警告）
  - 85-100: 赤色（危険）
- [ ] プログレスバーまたはゲージでの視覚化
- [ ] 値の変動がリアルタイムで反映される

---

## 7. 回帰テスト

### 7.1 既存機能動作確認

#### FT-REG-001: Messages CRUD 動作確認
**目的**: 既存のMessages機能が新機能追加後も正常動作することを検証

**手順**:
1. Messages一覧ページにアクセス
2. 新規メッセージ作成
3. メッセージ編集
4. メッセージ削除

**期待結果**:
- [ ] 一覧表示が正常に動作する
- [ ] 作成機能が正常に動作する
- [ ] 編集機能が正常に動作する
- [ ] 削除機能が正常に動作する
- [ ] APIとの統合が正常である

#### FT-REG-002: Intents CRUD 動作確認
**目的**: 既存のIntents機能の動作確認

**手順**:
1. Intents一覧ページにアクセス
2. 新規Intent作成
3. Intent詳細表示
4. Intentステータス更新
5. Intent削除

**期待結果**:
- [ ] 全てのCRUD操作が正常に動作する
- [ ] ステータス更新が正確に反映される
- [ ] UIの応答性が適切である

#### FT-REG-003: Specifications・Notifications 動作確認
**目的**: その他既存機能の動作確認

**手順**:
1. Specifications機能の基本動作確認
2. Notifications表示・管理機能確認

**期待結果**:
- [ ] 既存機能に機能劣化がない
- [ ] 新機能との競合が発生していない

---

## 8. パフォーマンステスト

### 8.1 初期表示速度テスト

#### FT-PERF-001: ページ読み込み速度
**目的**: 各ページの初期表示パフォーマンスを検証

**手順**:
1. ブラウザのPerformance タブを開く
2. キャッシュクリア
3. 各ページにアクセスして測定
4. Lighthouse スコア確認

**期待結果**:
- [ ] 矛盾検出ダッシュボード: First Contentful Paint < 1.5秒
- [ ] Dashboard Analytics: First Contentful Paint < 1.5秒
- [ ] Largest Contentful Paint < 3秒（全ページ）
- [ ] Lighthouse Performance スコア > 80

### 8.2 メモリ使用量テスト

#### FT-PERF-002: メモリ使用量監視
**目的**: 長時間使用時のメモリリークがないことを検証

**手順**:
1. ブラウザのMemory タブを開く
2. 各ページを順次アクセス
3. 30分間の連続使用をシミュレーション
4. メモリ使用量の変化を監視

**期待結果**:
- [ ] 初期メモリ使用量 < 30MB
- [ ] 30分使用後 < 50MB
- [ ] 明らかなメモリリークが発生しない
- [ ] ページ遷移後のメモリ解放が適切

---

## 9. エラー対処チェックリスト

### 9.1 フロントエンド固有のエラー

#### TypeScript コンパイルエラー
**症状**: `Type 'X' is not assignable to type 'Y'`

**対処手順**:
1. [ ] `src/types/api.ts` の型定義確認
2. [ ] インポート文の相対パス確認
3. [ ] `npm run type-check` で詳細エラー確認
4. [ ] 型定義とAPI レスポンスの一致確認

#### React コンポーネントエラー
**症状**: `Cannot read property of undefined` または白画面

**対処手順**:
1. [ ] ブラウザConsole でエラーメッセージ確認
2. [ ] React Developer Tools でコンポーネント状態確認
3. [ ] API データの存在確認
4. [ ] 条件分岐（data && ...）の実装確認

#### CSS スタイリング問題
**症状**: Tailwind CSS が効かない、レイアウト崩れ

**対処手順**:
1. [ ] `npm run build` でTailwind 再コンパイル
2. [ ] クラス名のスペルミス確認
3. [ ] ブラウザ開発者ツールでCSS 適用状況確認
4. [ ] Tailwind 設定ファイル確認

### 9.2 API統合エラー

#### CORS エラー
**症状**: `Access to fetch blocked by CORS policy`

**対処手順**:
1. [ ] バックエンドCORS 設定確認
2. [ ] `http://localhost:5173` が許可されているか確認
3. [ ] Preflight OPTIONS リクエストの処理確認

#### 404 Not Found
**症状**: API エンドポイントが見つからない

**対処手順**:
1. [ ] バックエンド API エンドポイント実装確認
2. [ ] URL パス確認
3. [ ] HTTP メソッド（GET/POST/PUT/DELETE）確認
4. [ ] バックエンドサーバー起動確認

---

## 10. 合否判定基準

### 10.1 Phase別合格基準

#### Phase 1 (矛盾検出UI) 【必須】
**合格条件**:
- [ ] 基本表示テスト: 5/5 テストケース合格
- [ ] データ表示テスト: 2/2 テストケース合格
- [ ] API統合テスト: 2/2 テストケース合格
- [ ] 合計: 9/9 テストケース合格 (100%)

**品質基準**:
- [ ] 初期表示速度 < 3秒
- [ ] メモリ使用量 < 30MB
- [ ] 回帰テスト全合格

#### Phase 2 (WebSocket統合) 【重要】
**合格条件**:
- [ ] WebSocket接続テスト: 2/2 テストケース合格
- [ ] 切断・再接続テスト: 1/1 テストケース合格
- [ ] 合計: 3/3 テストケース合格 (100%)

#### Phase 3 (Dashboard Analytics) 【重要】
**合格条件**:
- [ ] システムメトリクス表示: 2/2 テストケース合格
- [ ] 合計: 2/2 テストケース合格 (100%)

### 10.2 回帰テスト合格基準 【必須】

**合格条件**:
- [ ] Messages CRUD: 正常動作
- [ ] Intents CRUD: 正常動作
- [ ] Specifications・Notifications: 正常動作
- [ ] 機能劣化なし、新機能との競合なし

### 10.3 総合判定

| 判定 | 条件 |
|-----|------|
| **合格** | Phase 1 (100%) + 回帰テスト (100%) |
| **条件付き合格** | Phase 1 (100%) + 回帰テスト (100%) + Phase 2または3の80%以上 |
| **不合格** | Phase 1が100%未満、または回帰テストで機能劣化検出 |

### 10.4 報告書記載要件

テスト結果報告書には以下を明記すること：

```
Phase 1結果:
- 基本表示テスト: 5/5 合格 (100%)
- データ表示テスト: 2/2 合格 (100%)
- API統合テスト: 2/2 合格 (100%)
- 判定: 合格（必須基準達成）

Phase 2結果:
- WebSocket統合テスト: 3/3 合格 (100%)
- 判定: 合格（重要基準達成）

回帰テスト結果:
- 既存機能: 全て正常動作確認
- 機能劣化: なし
- 判定: 合格

総合判定: 合格
推奨対応: Phase 3 Dashboard Analyticsの実装で可視化完了
```

---

## 付録A: クイックリファレンス

### テスト実行コマンド

```bash
# フロントエンド起動
cd frontend && npm run dev

# バックエンド起動確認
curl http://localhost:8000/health

# 型チェック
npm run type-check

# ビルドテスト
npm run build

# Unit テスト（実装時）
npm run test

# E2E テスト（実装時）
npm run test:e2e
```

### デバッグ用確認コマンド

```bash
# 矛盾検出API確認
curl http://localhost:8000/api/contradictions/

# システムメトリクス確認
curl http://localhost:8000/api/dashboard/metrics

# WebSocket接続確認
wscat -c ws://localhost:8000/ws

# テストデータ作成
curl -X POST http://localhost:8000/api/contradictions/ \
  -H "Content-Type: application/json" \
  -d '{"level": "error", "message": "テスト矛盾", "confidence_score": 0.9}'
```

### ブラウザ開発者ツール活用

```
Network タブ: API リクエスト/レスポンス監視
Console タブ: JavaScript エラー確認
Performance タブ: 表示速度測定
Memory タブ: メモリ使用量監視
WS タブ: WebSocket 通信監視
```

---

**テスト仕様書作成者**: Claude Sonnet 4 (Kana)
**最終更新**: 2025-11-24
**バージョン**: 1.0（Frontend Core Features Implementation対応版）