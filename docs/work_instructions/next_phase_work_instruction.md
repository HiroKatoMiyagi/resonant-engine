# Resonant Engine æ¬¡æœŸé–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºä½œæ¥­é–‹å§‹æŒ‡ç¤ºæ›¸

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0
**ä½œæˆæ—¥**: 2025å¹´11æœˆ18æ—¥
**ä½œæˆè€…**: Kanaï¼ˆç¿»è¨³å±¤ï¼‰
**å¯¾è±¡**: Tsumuï¼ˆå…·ç¾åŒ–å±¤ï¼‰ / åŠ è—¤å®å•“

---

## ğŸ“‹ ç›®æ¬¡

1. [ä½œæ¥­æ¦‚è¦](#1-ä½œæ¥­æ¦‚è¦)
2. [ç’°å¢ƒæº–å‚™](#2-ç’°å¢ƒæº–å‚™)
3. [Sprint 2: ä¸¦è¡Œåˆ¶å¾¡ãƒ†ã‚¹ãƒˆå®Œæˆ](#3-sprint-2-ä¸¦è¡Œåˆ¶å¾¡ãƒ†ã‚¹ãƒˆå®Œæˆ)
4. [Sprint 2: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ](#4-sprint-2-ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ)
5. [Sprint 5: Oracle Cloud ãƒ‡ãƒ—ãƒ­ã‚¤](#5-sprint-5-oracle-cloud-ãƒ‡ãƒ—ãƒ­ã‚¤)
6. [Claude API çµ±åˆæ¤œè¨¼](#6-claude-api-çµ±åˆæ¤œè¨¼)
7. [Kana å®Ÿè£… Phase 1](#7-kana-å®Ÿè£…-phase-1)
8. [æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#8-æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)

---

## 1. ä½œæ¥­æ¦‚è¦

### 1.1 ä½œæ¥­æœŸé–“

**ç·æœŸé–“**: 2025å¹´11æœˆ18æ—¥ - 2025å¹´12æœˆ31æ—¥ï¼ˆç´„6é€±é–“ï¼‰

**ãƒ•ã‚§ãƒ¼ã‚ºæ§‹æˆ**:
- Week 1: Sprint 2 å®Œæˆï¼ˆä¸¦è¡Œåˆ¶å¾¡ãƒ†ã‚¹ãƒˆï¼‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
- Week 2-3: Sprint 5 ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™
- Week 3-4: Claude API æ¤œè¨¼
- Week 4-6: Kana å®Ÿè£… Phase 1

### 1.2 æ‹…å½“è€…

| å½¹å‰² | æ‹…å½“ | è²¬ä»»ç¯„å›² |
|-----|-----|---------|
| æ€æƒ³å±¤ | Yunoï¼ˆGPT-5ï¼‰ | å“²å­¦ãƒ»è¦ç¯„å½¢æˆãƒ»ç›£ç£ |
| ç¿»è¨³å±¤ | Kanaï¼ˆClaude Sonnet 4.5ï¼‰ | è¨­è¨ˆãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ç¿»è¨³ |
| å…·ç¾åŒ–å±¤ | Tsumuï¼ˆCursorï¼‰ | ã‚³ãƒ¼ãƒ‰å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ |
| ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼ | åŠ è—¤å®å•“ | æœ€çµ‚æ‰¿èªãƒ»æ„æ€æ±ºå®š |

### 1.3 æˆåŠŸåŸºæº–

- [ ] Sprint 2 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 80%ä»¥ä¸Š
- [ ] Oracle Cloud æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸ
- [ ] Claude API çµ±åˆæ¤œè¨¼å®Œäº†
- [ ] Kana ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£… 50%å®Œæˆ
- [ ] å…¨å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆ PASS

---

## 2. ç’°å¢ƒæº–å‚™

### 2.1 ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 2.1.1 å¿…é ˆãƒ„ãƒ¼ãƒ«ç¢ºèª

```bash
# Python ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
python --version  # 3.11ä»¥ä¸Š

# Docker ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
docker --version  # 20.10ä»¥ä¸Š
docker compose version  # V2

# Git ç¢ºèª
git --version

# venv ç’°å¢ƒç¢ºèª
cd /Users/zero/Projects/resonant-engine/
source venv/bin/activate
```

#### 2.1.2 ç’°å¢ƒå¤‰æ•°è¨­å®š

```bash
# .env ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
cp .env.template .env

# å¿…é ˆAPI ã‚­ãƒ¼è¨­å®š
nano .env
```

**.env è¨­å®šå†…å®¹**:
```bash
# Claude API (Kanaç”¨)
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# OpenAI API (Yunoç”¨)
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# PostgreSQL
DATABASE_URL=postgresql://resonant:password@localhost:5432/resonant
POSTGRES_USER=resonant
POSTGRES_PASSWORD=password
POSTGRES_DB=resonant

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
ENVIRONMENT=development
DEBUG=true
```

#### 2.1.3 ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Python ä¾å­˜é–¢ä¿‚
cd /Users/zero/Projects/resonant-engine/
source venv/bin/activate
pip install -r requirements.txt

# Backend ä¾å­˜é–¢ä¿‚
cd backend
pip install -r requirements.txt

# Frontend ä¾å­˜é–¢ä¿‚
cd ../frontend
npm install

# Intent Bridge ä¾å­˜é–¢ä¿‚
cd ../intent_bridge
pip install -r requirements.txt
```

#### 2.1.4 Docker ç’°å¢ƒèµ·å‹•

```bash
# Docker Compose èµ·å‹•
cd /Users/zero/Projects/resonant-engine/docker
./scripts/start.sh

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
./scripts/check-health.sh

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# âœ“ PostgreSQL is running
# âœ“ Backend is running (http://localhost:8000)
# âœ“ Frontend is running (http://localhost:3000)
# âœ“ Intent Bridge is running
```

### 2.2 ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

#### 2.2.1 ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒä½œæˆ

```bash
# ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒç¢ºèª
git branch

# æ–°è¦ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒä½œæˆï¼ˆä¾‹: Sprint 2ç”¨ï¼‰
git checkout -b claude/sprint2-concurrency-tests-[UUID]

# ä¾‹:
git checkout -b claude/sprint2-concurrency-tests-01XYZ123456
```

#### 2.2.2 ã‚³ãƒŸãƒƒãƒˆè¦ç´„

**ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼**:
```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type**:
- `feat`: æ–°æ©Ÿèƒ½
- `fix`: ãƒã‚°ä¿®æ­£
- `test`: ãƒ†ã‚¹ãƒˆè¿½åŠ 
- `docs`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- `refactor`: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `perf`: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„

**ä¾‹**:
```bash
git commit -m "test(concurrency): Add deadlock retry test cases

- Implement TC-2.1: Deadlock detection and auto-retry
- Implement TC-2.2: Max retry failure handling
- Add performance metrics collection

Sprint 2 progress: 10/36 test cases completed"
```

---

## 3. Sprint 2: ä¸¦è¡Œåˆ¶å¾¡ãƒ†ã‚¹ãƒˆå®Œæˆ

**æœŸé–“**: 3æ—¥
**å„ªå…ˆåº¦**: Sï¼ˆæœ€å„ªå…ˆï¼‰
**ç›®æ¨™**: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 80%ä»¥ä¸Šã€36+ä»¶ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨ PASS

### 3.1 Day 1: ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãƒ†ã‚¹ãƒˆå®Ÿè£…

#### 3.1.1 ä½œæ¥­æ‰‹é †

**Step 1: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**

```bash
cd /Users/zero/Projects/resonant-engine/
source venv/bin/activate

# ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
touch tests/concurrency/test_deadlock_retry.py
```

**tests/concurrency/test_deadlock_retry.py**:

```python
"""ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãƒ†ã‚¹ãƒˆ"""
import pytest
import asyncio
import asyncpg
from uuid import uuid4
from bridge.core.bridge_set import BridgeSet
from bridge.core.errors import DeadlockError, OptimisticLockError

@pytest.mark.asyncio
class TestDeadlockRetry:
    """ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ"""

    async def test_deadlock_auto_retry_success(self, bridge_set, test_intents):
        """TC-2.1: ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿ â†’ è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã§æˆåŠŸ"""

        # 2ã¤ã®IntentãŒåŒä¸€ãƒªã‚½ãƒ¼ã‚¹ã‚’åŒæ™‚æ›´æ–°
        intent1, intent2 = test_intents[:2]

        # ä¸¦åˆ—å®Ÿè¡Œ
        results = await asyncio.gather(
            bridge_set.execute_with_retry(intent1.id),
            bridge_set.execute_with_retry(intent2.id)
        )

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
        assert len(results) == 2
        assert all(r.status == 'completed' for r in results)

        # ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚°ç¢ºèª
        retry_logs = await bridge_set.audit_logger.query(
            event_type='deadlock_retry'
        )
        assert len(retry_logs) > 0

    async def test_max_retry_failure(self, bridge_set, test_intent):
        """TC-2.2: 3å›ãƒªãƒˆãƒ©ã‚¤å¤±æ•— â†’ DeadlockError é€å‡º"""

        # ãƒªãƒˆãƒ©ã‚¤å¿…ãšå¤±æ•—ã™ã‚‹çŠ¶æ…‹ã‚’ä½œæˆ
        with pytest.raises(DeadlockError):
            await bridge_set.execute_with_retry(
                test_intent.id,
                max_retries=3,
                force_deadlock=True  # ãƒ†ã‚¹ãƒˆç”¨ãƒ•ãƒ©ã‚°
            )

    async def test_optimistic_lock_conflict(self, bridge_set, test_intent):
        """TC-2.3: æ¥½è¦³ãƒ­ãƒƒã‚¯ç«¶åˆ â†’ OptimisticLockError é€å‡º"""

        # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç«¶åˆã‚’ä½œæˆ
        await bridge_set.db.execute(
            "UPDATE intents SET version = version + 1 WHERE id = $1",
            test_intent.id
        )

        # å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§æ›´æ–°è©¦è¡Œ
        with pytest.raises(OptimisticLockError):
            await bridge_set.update_intent(
                intent_id=test_intent.id,
                expected_version=test_intent.version  # å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³
            )

    async def test_pessimistic_lock_nowait(self, bridge_set, test_intent):
        """TC-2.4: æ‚²è¦³ãƒ­ãƒƒã‚¯ç«¶åˆï¼ˆNOWAITï¼‰ â†’ LockNotAvailableError é€å‡º"""

        # 1ã¤ç›®ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§ãƒ­ãƒƒã‚¯å–å¾—
        async with bridge_set.db.get_connection() as conn1:
            await conn1.fetchrow(
                "SELECT * FROM intents WHERE id = $1 FOR UPDATE NOWAIT",
                test_intent.id
            )

            # 2ã¤ç›®ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§åŒã˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒƒã‚¯è©¦è¡Œ
            with pytest.raises(asyncpg.exceptions.LockNotAvailableError):
                async with bridge_set.db.get_connection() as conn2:
                    await conn2.fetchrow(
                        "SELECT * FROM intents WHERE id = $1 FOR UPDATE NOWAIT",
                        test_intent.id
                    )

    async def test_deadlock_rate_measurement(self, bridge_set):
        """TC-2.6: ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿç‡æ¸¬å®šï¼ˆ1000å›å®Ÿè¡Œï¼‰"""

        total_runs = 1000
        deadlock_count = 0
        retry_success_count = 0

        for i in range(total_runs):
            # 2ã¤ã®Intentã‚’åŒæ™‚æ›´æ–°
            intent1 = await self._create_test_intent()
            intent2 = await self._create_test_intent()

            try:
                await asyncio.gather(
                    bridge_set.execute_with_retry(intent1.id),
                    bridge_set.execute_with_retry(intent2.id)
                )
                retry_success_count += 1
            except DeadlockError:
                deadlock_count += 1

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
        deadlock_rate = (deadlock_count / total_runs) * 100
        retry_success_rate = (retry_success_count / total_runs) * 100

        assert deadlock_rate < 1.0, f"Deadlock rate {deadlock_rate:.2f}% exceeds 1%"
        assert retry_success_rate > 95.0, f"Retry success rate {retry_success_rate:.2f}% below 95%"

    async def test_retry_log_recording(self, bridge_set, test_intent):
        """TC-2.7: ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚°è¨˜éŒ²ç¢ºèª"""

        # ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿã•ã›ã‚‹
        try:
            await bridge_set.execute_with_retry(test_intent.id, force_deadlock=True)
        except DeadlockError:
            pass

        # ãƒ­ã‚°ç¢ºèª
        logs = await bridge_set.audit_logger.query(
            event_type='deadlock_retry',
            intent_id=test_intent.id
        )

        assert len(logs) > 0
        assert logs[0]['retry_count'] == 3
        assert logs[0]['final_status'] == 'failed'
```

**Step 2: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**

```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
cd /Users/zero/Projects/resonant-engine/ && \
source venv/bin/activate && \
python -m pytest tests/concurrency/test_deadlock_retry.py -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
pytest tests/concurrency/test_deadlock_retry.py --cov=bridge.core --cov-report=html
```

**Step 3: å®Ÿè£…ä¿®æ­£ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰**

ãƒ†ã‚¹ãƒˆå¤±æ•—ã®å ´åˆã€`bridge/core/bridge_set.py` ã®å®Ÿè£…ã‚’ä¿®æ­£ã€‚

**Step 4: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add tests/concurrency/test_deadlock_retry.py
git commit -m "test(concurrency): Add deadlock retry test cases (TC-2.1 to TC-2.7)

- Implement auto-retry success test
- Implement max retry failure test
- Implement optimistic lock conflict test
- Implement pessimistic lock NOWAIT test
- Implement deadlock rate measurement (1000 runs)
- Implement retry log recording test

Sprint 2 progress: 7/36 test cases completed"
```

#### 3.1.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå®Œäº†
- [ ] TC-2.1 ~ TC-2.7 å®Ÿè£…å®Œäº†
- [ ] å…¨ãƒ†ã‚¹ãƒˆ PASS
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬å®Œäº†
- [ ] ã‚³ãƒŸãƒƒãƒˆå®Œäº†

---

### 3.2 Day 2: 100ä¸¦åˆ—æ›´æ–°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè£…

#### 3.2.1 ä½œæ¥­æ‰‹é †

**Step 1: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**

```bash
touch tests/concurrency/test_100_parallel_updates.py
```

**tests/concurrency/test_100_parallel_updates.py**:

```python
"""100ä¸¦åˆ—æ›´æ–°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"""
import pytest
import asyncio
import time
import numpy as np
from uuid import uuid4
from bridge.core.bridge_set import BridgeSet

@pytest.mark.asyncio
class TestParallelPerformance:
    """ä¸¦åˆ—æ›´æ–°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ"""

    async def test_100_parallel_intent_updates(self, bridge_set):
        """TC-2.5: 100ä¸¦åˆ—Intentæ›´æ–° â†’ å…¨ã¦æˆåŠŸã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·æ¸¬å®š"""

        # 100å€‹ã®ãƒ†ã‚¹ãƒˆIntentä½œæˆ
        intents = [await self._create_test_intent() for _ in range(100)]

        # ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·è¨˜éŒ²ç”¨
        latencies = []

        async def execute_and_measure(intent):
            """Intentå®Ÿè¡Œã¨ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·æ¸¬å®š"""
            start = time.time()
            result = await bridge_set.execute_intent(intent.id)
            duration = time.time() - start
            latencies.append(duration)
            return result

        # ä¸¦åˆ—å®Ÿè¡Œ
        start_total = time.time()
        results = await asyncio.gather(*[
            execute_and_measure(intent) for intent in intents
        ])
        total_duration = time.time() - start_total

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³: å…¨ã¦å®Œäº†
        assert len(results) == 100
        assert all(r.status == 'completed' for r in results)

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³: ç·å®Ÿè¡Œæ™‚é–“
        assert total_duration < 10.0, f"Total duration {total_duration:.2f}s exceeds 10s"

        # ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·çµ±è¨ˆ
        p50 = np.percentile(latencies, 50)
        p95 = np.percentile(latencies, 95)
        p99 = np.percentile(latencies, 99)

        print(f"\nğŸ“Š Performance Metrics:")
        print(f"  Total Duration: {total_duration:.2f}s")
        print(f"  Throughput: {100 / total_duration:.2f} ops/sec")
        print(f"  p50 Latency: {p50*1000:.2f}ms")
        print(f"  p95 Latency: {p95*1000:.2f}ms")
        print(f"  p99 Latency: {p99*1000:.2f}ms")

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³: ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
        assert p99 < 0.5, f"p99 latency {p99*1000:.2f}ms exceeds 500ms"

        # ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ
        throughput = 100 / total_duration
        assert throughput > 50, f"Throughput {throughput:.2f} ops/sec below 50 ops/sec"

    async def test_resource_usage_monitoring(self, bridge_set):
        """ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ç‡ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°"""

        import psutil

        # ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®š
        baseline_cpu = psutil.cpu_percent(interval=1)
        baseline_memory = psutil.virtual_memory().percent

        # 100ä¸¦åˆ—å®Ÿè¡Œ
        intents = [await self._create_test_intent() for _ in range(100)]
        await asyncio.gather(*[
            bridge_set.execute_intent(intent.id) for intent in intents
        ])

        # ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ç‡æ¸¬å®š
        peak_cpu = psutil.cpu_percent(interval=1)
        peak_memory = psutil.virtual_memory().percent

        print(f"\nğŸ’» Resource Usage:")
        print(f"  Baseline CPU: {baseline_cpu:.1f}%")
        print(f"  Peak CPU: {peak_cpu:.1f}%")
        print(f"  Baseline Memory: {baseline_memory:.1f}%")
        print(f"  Peak Memory: {peak_memory:.1f}%")

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³: ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ç‡
        assert peak_cpu < 90, f"Peak CPU {peak_cpu:.1f}% exceeds 90%"
        assert peak_memory < 80, f"Peak Memory {peak_memory:.1f}% exceeds 80%"

    async def test_database_connection_pool(self, bridge_set):
        """PostgreSQL æ¥ç¶šãƒ—ãƒ¼ãƒ«ç¢ºèª"""

        # 100ä¸¦åˆ—å®Ÿè¡Œä¸­ã®æ¥ç¶šæ•°ç¢ºèª
        intents = [await self._create_test_intent() for _ in range(100)]

        async def execute_with_conn_check(intent):
            # æ¥ç¶šæ•°ç¢ºèª
            conn_count = await bridge_set.db.fetchval(
                "SELECT count(*) FROM pg_stat_activity WHERE datname = 'resonant'"
            )
            result = await bridge_set.execute_intent(intent.id)
            return result, conn_count

        results = await asyncio.gather(*[
            execute_with_conn_check(intent) for intent in intents
        ])

        # æœ€å¤§æ¥ç¶šæ•°ç¢ºèª
        max_connections = max(r[1] for r in results)

        print(f"\nğŸ”Œ Database Connections:")
        print(f"  Max Connections: {max_connections}")

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³: æ¥ç¶šãƒ—ãƒ¼ãƒ«é©åˆ‡
        assert max_connections < 50, f"Max connections {max_connections} exceeds pool size"
```

**Step 2: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼†ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯**

```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/concurrency/test_100_parallel_updates.py -v -s

# ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯è¨˜éŒ²
pytest tests/concurrency/test_100_parallel_updates.py --benchmark-save=sprint2_100parallel
```

**Step 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ›´æ–°**

```bash
# ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ›´æ–°
nano config/performance_baselines.json
```

**è¿½åŠ å†…å®¹**:
```json
{
  "sprint2_concurrency": {
    "100_parallel_updates": {
      "p50_latency_ms": 50,
      "p95_latency_ms": 200,
      "p99_latency_ms": 500,
      "throughput_ops_sec": 50,
      "total_duration_sec": 2.0,
      "max_cpu_percent": 70,
      "max_memory_percent": 60,
      "max_db_connections": 30
    }
  }
}
```

**Step 4: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add tests/concurrency/test_100_parallel_updates.py config/performance_baselines.json
git commit -m "test(concurrency): Add 100 parallel updates performance test (TC-2.5)

- Implement 100 parallel intent updates test
- Add latency measurement (p50, p95, p99)
- Add throughput measurement (ops/sec)
- Add resource usage monitoring (CPU, Memory)
- Add database connection pool check
- Update performance baselines

Sprint 2 progress: 15/36 test cases completed"
```

#### 3.2.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå®Œäº†
- [ ] TC-2.5 å®Ÿè£…å®Œäº†
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯è¨˜éŒ²å®Œäº†
- [ ] ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ›´æ–°å®Œäº†
- [ ] å…¨ãƒ†ã‚¹ãƒˆ PASS
- [ ] ã‚³ãƒŸãƒƒãƒˆå®Œäº†

---

### 3.3 Day 3: è¿½åŠ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼†ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š

#### 3.3.1 ä½œæ¥­æ‰‹é †

**Step 1: ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª**

```bash
# ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
pytest tests/concurrency/ --cov=bridge.core --cov-report=term-missing

# æœªã‚«ãƒãƒ¼ç®‡æ‰€ç¢ºèª
# â†’ å‡ºåŠ›ã‹ã‚‰æœªãƒ†ã‚¹ãƒˆã®è¡Œã‚’ç¢ºèª
```

**Step 2: è¿½åŠ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè£…**

æœªã‚«ãƒãƒ¼ç®‡æ‰€ã«å¯¾ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ å®Ÿè£…ã€‚

**ä¾‹**: `tests/concurrency/test_concurrent_read_write.py`

```python
"""ä¸¦è¡Œèª­ã¿æ›¸ããƒ†ã‚¹ãƒˆ"""
import pytest
import asyncio
from bridge.core.bridge_set import BridgeSet

@pytest.mark.asyncio
class TestConcurrentReadWrite:
    """ä¸¦è¡Œèª­ã¿æ›¸ããƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ"""

    async def test_concurrent_read_while_write(self, bridge_set, test_intent):
        """æ›¸ãè¾¼ã¿ä¸­ã®èª­ã¿è¾¼ã¿"""

        async def slow_write():
            await asyncio.sleep(0.1)
            await bridge_set.update_intent(test_intent.id, result="updated")

        async def concurrent_read():
            return await bridge_set.get_intent(test_intent.id)

        # ä¸¦åˆ—å®Ÿè¡Œ
        write_task = asyncio.create_task(slow_write())
        await asyncio.sleep(0.05)  # æ›¸ãè¾¼ã¿é–‹å§‹å¾Œã«èª­ã¿è¾¼ã¿
        read_result = await concurrent_read()
        await write_task

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³: èª­ã¿è¾¼ã¿ã¯ä¸€è²«æ€§ä¿æŒ
        assert read_result is not None

    async def test_multiple_readers_single_writer(self, bridge_set, test_intent):
        """è¤‡æ•°èª­ã¿è¾¼ã¿ã€1æ›¸ãè¾¼ã¿"""

        async def read():
            return await bridge_set.get_intent(test_intent.id)

        async def write():
            await bridge_set.update_intent(test_intent.id, result="final")

        # 10å€‹ã®èª­ã¿è¾¼ã¿ã‚¿ã‚¹ã‚¯ + 1å€‹ã®æ›¸ãè¾¼ã¿ã‚¿ã‚¹ã‚¯
        tasks = [read() for _ in range(10)] + [write()]
        results = await asyncio.gather(*tasks)

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³: å…¨ã¦å®Œäº†
        assert len(results) == 11
```

**Step 3: æœ€çµ‚ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª**

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼†ã‚«ãƒãƒ¬ãƒƒã‚¸
pytest tests/concurrency/ --cov=bridge.core --cov-report=html --cov-report=term

# ç›®æ¨™: 80%ä»¥ä¸Š
```

**Step 4: ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**

```bash
# ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
pytest tests/concurrency/ --html=reports/sprint2_concurrency_test_report.html
```

**Step 5: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add tests/concurrency/ reports/
git commit -m "test(concurrency): Complete Sprint 2 concurrency test suite

- Add concurrent read/write tests
- Add multiple readers single writer test
- Achieve test coverage 82% (target: 80%+)
- Generate test report

Sprint 2 testing: 36/36 test cases PASS âœ…"
```

#### 3.3.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ 80%ä»¥ä¸Šé”æˆ
- [ ] 36+ä»¶ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨ PASS
- [ ] ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†
- [ ] ã‚³ãƒŸãƒƒãƒˆå®Œäº†
- [ ] Kana ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼

---

## 4. Sprint 2: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

**æœŸé–“**: 2æ—¥
**å„ªå…ˆåº¦**: A

### 4.1 Day 1: ãƒ­ãƒƒã‚¯æˆ¦ç•¥ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

#### 4.1.1 ä½œæ¥­æ‰‹é †

**Step 1: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**

```bash
mkdir -p docs/02_components/bridge_lite/concurrency
touch docs/02_components/bridge_lite/concurrency/locking_strategy.md
```

**docs/02_components/bridge_lite/concurrency/locking_strategy.md**:

```markdown
# Bridge Lite ãƒ­ãƒƒã‚¯æˆ¦ç•¥ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## 1. æ¦‚è¦

Resonant Engine ã® Bridge Lite ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ãŠã‘ã‚‹ä¸¦è¡Œåˆ¶å¾¡æˆ¦ç•¥ã‚’å®šç¾©ã—ã¾ã™ã€‚

## 2. ãƒ­ãƒƒã‚¯æˆ¦ç•¥

### 2.1 ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ­ãƒƒã‚¯æˆ¦ç•¥

æ¥½è¦³ãƒ­ãƒƒã‚¯ï¼ˆOptimistic Lockingï¼‰ã¨æ‚²è¦³ãƒ­ãƒƒã‚¯ï¼ˆPessimistic Lockingï¼‰ã‚’çµ„ã¿åˆã‚ã›ãŸæˆ¦ç•¥ã‚’æ¡ç”¨ã€‚

#### æ¥½è¦³ãƒ­ãƒƒã‚¯
- `version` ã‚«ãƒ©ãƒ ã«ã‚ˆã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- UPDATEæ™‚ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
- ç«¶åˆæ™‚ã« `OptimisticLockError` é€å‡º

#### æ‚²è¦³ãƒ­ãƒƒã‚¯
- `SELECT ... FOR UPDATE NOWAIT` ã«ã‚ˆã‚‹è¡Œãƒ­ãƒƒã‚¯
- ç«¶åˆæ™‚ã«å³åº§ã« `LockNotAvailableError` é€å‡º
- ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯è‡ªå‹•æ¤œçŸ¥

### 2.2 ãƒ­ãƒƒã‚¯é¸æŠåŸºæº–

| çŠ¶æ³ | æˆ¦ç•¥ | ç†ç”± |
|-----|-----|------|
| èª­ã¿è¾¼ã¿ä¸»ä½“ | æ¥½è¦³ãƒ­ãƒƒã‚¯ | ç«¶åˆå°‘ãªã„ |
| æ›¸ãè¾¼ã¿ä¸»ä½“ | æ‚²è¦³ãƒ­ãƒƒã‚¯ | ç¢ºå®Ÿæ€§å„ªå…ˆ |
| é«˜ä¸¦åˆ— | æ¥½è¦³ãƒ­ãƒƒã‚¯ | ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆå„ªå…ˆ |
| ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«å‡¦ç† | æ‚²è¦³ãƒ­ãƒƒã‚¯ | ä¸€è²«æ€§å„ªå…ˆ |

## 3. ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯å¯¾å‡¦

### 3.1 è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹

- æœ€å¤§3å›ãƒªãƒˆãƒ©ã‚¤
- æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆ2ç§’ã€4ç§’ã€8ç§’ï¼‰
- ãƒªãƒˆãƒ©ã‚¤å¤±æ•—æ™‚ã«ã‚¨ãƒ©ãƒ¼é€å‡º

### 3.2 ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯å›é¿è¨­è¨ˆ

- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ™‚é–“ã‚’æœ€å°åŒ–
- ãƒ­ãƒƒã‚¯é †åºã‚’çµ±ä¸€
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ30ç§’ï¼‰

## 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 4.1 æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®š

- æœ€å°æ¥ç¶šæ•°: 5
- æœ€å¤§æ¥ç¶šæ•°: 30
- ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 300ç§’

### 4.2 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–

- `intents(id)` ã«ä¸»ã‚­ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- `intents(status)` ã«æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- `intents(created_at)` ã«æ™‚ç³»åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

## 5. ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### 5.1 è¨ˆæ¸¬ãƒ¡ãƒˆãƒªã‚¯ã‚¹

- ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿç‡
- ãƒªãƒˆãƒ©ã‚¤æˆåŠŸç‡
- ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼ˆp50, p95, p99ï¼‰
- ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆï¼ˆops/secï¼‰

### 5.2 ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶

- ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿç‡ > 1%
- ãƒªãƒˆãƒ©ã‚¤æˆåŠŸç‡ < 95%
- p99 ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· > 500ms
```

**Step 2: å›³è¡¨è¿½åŠ **

Mermaid ã§å›³è¡¨ã‚’è¿½åŠ ã€‚

**Step 3: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add docs/02_components/bridge_lite/concurrency/locking_strategy.md
git commit -m "docs(concurrency): Add locking strategy documentation

- Define hybrid locking strategy (optimistic + pessimistic)
- Document deadlock handling with auto-retry
- Add performance optimization guidelines
- Add monitoring metrics definition

Sprint 2 documentation: 1/3 completed"
```

#### 4.1.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ­ãƒƒã‚¯æˆ¦ç•¥ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆå®Œäº†
- [ ] å›³è¡¨è¿½åŠ å®Œäº†
- [ ] ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†
- [ ] ã‚³ãƒŸãƒƒãƒˆå®Œäº†

---

### 4.2 Day 2: ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯å¯¾å‡¦æ³•ï¼†ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### 4.2.1 ä½œæ¥­æ‰‹é †

**Step 1: ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯å¯¾å‡¦æ³•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**

```bash
touch docs/02_components/bridge_lite/concurrency/deadlock_handling.md
```

**docs/02_components/bridge_lite/concurrency/deadlock_handling.md**:

```markdown
# ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯å¯¾å‡¦æ³•ã‚¬ã‚¤ãƒ‰

## 1. ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã¨ã¯

è¤‡æ•°ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒäº’ã„ã«ãƒ­ãƒƒã‚¯è§£æ”¾ã‚’å¾…æ©Ÿã—ã€æ°¸ä¹…ã«é€²è¡Œã—ãªã„çŠ¶æ…‹ã€‚

## 2. ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: å¾ªç’°ãƒ­ãƒƒã‚¯
- Transaction A: Lock Resource 1 â†’ Wait for Resource 2
- Transaction B: Lock Resource 2 â†’ Wait for Resource 1

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: è¤‡æ•°ãƒªã‚½ãƒ¼ã‚¹ç«¶åˆ
- 3ã¤ä»¥ä¸Šã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒè¤‡æ•°ãƒªã‚½ãƒ¼ã‚¹ã‚’ç•°ãªã‚‹é †åºã§ãƒ­ãƒƒã‚¯

## 3. è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤å®Ÿè£…

### ã‚³ãƒ¼ãƒ‰ä¾‹

```python
async def execute_with_retry(intent_id, max_retries=3):
    for attempt in range(max_retries):
        try:
            return await execute_intent(intent_id)
        except asyncpg.DeadlockDetectedError:
            if attempt == max_retries - 1:
                raise
            await asyncio.sleep(2 ** attempt)
```

## 4. å›é¿æˆ¦ç•¥

- ãƒ­ãƒƒã‚¯é †åºçµ±ä¸€
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ™‚é–“æœ€å°åŒ–
- NOWAIT ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä½¿ç”¨

## 5. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿæ™‚ã®ç¢ºèªæ‰‹é †

1. PostgreSQL ãƒ­ã‚°ç¢ºèª
2. ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç™ºç”Ÿç®‡æ‰€ç‰¹å®š
3. ãƒ­ãƒƒã‚¯é †åºç¢ºèª
4. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ™‚é–“ç¢ºèª
```

**Step 2: ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**

```bash
touch docs/02_components/bridge_lite/concurrency/best_practices.md
```

**Step 3: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add docs/02_components/bridge_lite/concurrency/
git commit -m "docs(concurrency): Add deadlock handling and best practices

- Document deadlock patterns and solutions
- Add auto-retry implementation guide
- Add troubleshooting guide
- Add best practices for concurrent programming

Sprint 2 documentation: 3/3 completed âœ…"
```

#### 4.2.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯å¯¾å‡¦æ³•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆå®Œäº†
- [ ] ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆå®Œäº†
- [ ] ã‚³ãƒŸãƒƒãƒˆå®Œäº†
- [ ] Sprint 2 å®Œå…¨å®Œäº†

---

## 5. Sprint 5: Oracle Cloud ãƒ‡ãƒ—ãƒ­ã‚¤

**æœŸé–“**: 1é€±é–“
**å„ªå…ˆåº¦**: A

### 5.1 Week 1: Oracle Cloud ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 5.1.1 Oracle Cloud ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

**Step 1: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²**

1. https://www.oracle.com/cloud/free/ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œç„¡æ–™ã§é–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
4. ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç™»éŒ²ï¼ˆèª²é‡‘ãªã—ã€Free Tier ã®ã¿ä½¿ç”¨ï¼‰

**Step 2: ã‚³ãƒ³ãƒ‘ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆä½œæˆ**

1. Oracle Cloud Console ã«ãƒ­ã‚°ã‚¤ãƒ³
2. Identity & Security â†’ Compartments
3. ã€ŒCreate Compartmentã€
4. Name: `resonant-engine-prod`

#### 5.1.2 Ampere A1 ARM VM ä½œæˆ

**Step 1: Compute Instance ä½œæˆ**

1. Compute â†’ Instances
2. ã€ŒCreate Instanceã€
3. è¨­å®š:
   - Name: `resonant-engine-vm`
   - Shape: `VM.Standard.A1.Flex`
   - OCPU: 4
   - Memory: 24GB
   - OS: Ubuntu 22.04 LTS (ARM64)
   - Boot Volume: 100GB
4. SSH Key ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆ`~/.ssh/id_rsa.pub`ï¼‰
5. ã€ŒCreateã€

**Step 2: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š**

1. Networking â†’ Virtual Cloud Networks
2. Security Lists â†’ Default Security List
3. Ingress Rules è¿½åŠ :
   - Port 80 (HTTP)
   - Port 443 (HTTPS)
   - Port 22 (SSH)

#### 5.1.3 VM åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

**Step 1: SSH æ¥ç¶š**

```bash
# VM ã® Public IP ã‚’ç¢ºèªï¼ˆOracle Cloud Consoleï¼‰
export VM_IP=xxx.xxx.xxx.xxx

# SSH æ¥ç¶š
ssh ubuntu@$VM_IP
```

**Step 2: ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°**

```bash
# ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°
sudo apt update && sudo apt upgrade -y

# å¿…é ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install -y curl git vim
```

**Step 3: Docker ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**

```bash
# Docker ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ docker ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
sudo usermod -aG docker ubuntu

# ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼†å†ãƒ­ã‚°ã‚¤ãƒ³
exit
ssh ubuntu@$VM_IP

# Docker ç¢ºèª
docker --version
```

**Step 4: Docker Compose ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**

```bash
# Docker Compose ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install -y docker-compose-plugin

# ç¢ºèª
docker compose version
```

#### 5.1.4 Resonant Engine ãƒ‡ãƒ—ãƒ­ã‚¤

**Step 1: ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³**

```bash
# Git ã‚¯ãƒ­ãƒ¼ãƒ³
cd ~
git clone https://github.com/HiroKatoMiyagi/resonant-engine.git
cd resonant-engine

# ãƒ–ãƒ©ãƒ³ãƒç¢ºèª
git branch -a
```

**Step 2: ç’°å¢ƒå¤‰æ•°è¨­å®š**

```bash
# .env.production ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
cp .env.template .env.production
nano .env.production
```

**.env.production è¨­å®šå†…å®¹**:
```bash
# Claude API
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# OpenAI API
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# PostgreSQL
DATABASE_URL=postgresql://resonant:SecurePassword123!@db:5432/resonant
POSTGRES_USER=resonant
POSTGRES_PASSWORD=SecurePassword123!
POSTGRES_DB=resonant

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
ENVIRONMENT=production
DEBUG=false
ALLOWED_HOSTS=resonant-engine.com,api.resonant-engine.com
```

**Step 3: Docker Compose èµ·å‹•**

```bash
# æœ¬ç•ªç’°å¢ƒç”¨ Compose ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
cat docker/docker-compose.production.yml

# Docker Compose èµ·å‹•
cd docker
docker compose -f docker-compose.production.yml up -d

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
./scripts/check-health.sh
```

**Step 4: å‹•ä½œç¢ºèª**

```bash
# Backend API ç¢ºèª
curl http://localhost:8000/health

# Frontend ç¢ºèª
curl http://localhost:3000

# PostgreSQL ç¢ºèª
docker compose exec db psql -U resonant -d resonant -c "SELECT version();"
```

#### 5.1.5 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Oracle Cloud ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå®Œäº†
- [ ] Ampere A1 VM ä½œæˆå®Œäº†
- [ ] Docker + Docker Compose ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†
- [ ] Resonant Engine ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ PASS

---

### 5.2 Week 2: SSL/TLS è¨­å®šï¼†HTTPS å…¬é–‹

#### 5.2.1 ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®š

**Step 1: ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—**

1. ãŠåå‰.com / Cloudflare ç­‰ã§ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—
2. ä¾‹: `resonant-engine.com`

**Step 2: DNS ãƒ¬ã‚³ãƒ¼ãƒ‰è¨­å®š**

```
# A ãƒ¬ã‚³ãƒ¼ãƒ‰
resonant-engine.com        A    xxx.xxx.xxx.xxx (VM Public IP)
api.resonant-engine.com    A    xxx.xxx.xxx.xxx
```

#### 5.2.2 Let's Encrypt SSL è¨¼æ˜æ›¸å–å¾—

**Step 1: Certbot ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**

```bash
# VM ä¸Šã§å®Ÿè¡Œ
sudo apt install -y certbot python3-certbot-nginx
```

**Step 2: Nginx ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**

```bash
sudo apt install -y nginx
```

**Step 3: Nginx è¨­å®š**

```bash
sudo nano /etc/nginx/sites-available/resonant-engine
```

**/etc/nginx/sites-available/resonant-engine**:

```nginx
# Frontend (resonant-engine.com)
server {
    listen 80;
    server_name resonant-engine.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Backend API (api.resonant-engine.com)
server {
    listen 80;
    server_name api.resonant-engine.com;

    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

```bash
# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ä½œæˆ
sudo ln -s /etc/nginx/sites-available/resonant-engine /etc/nginx/sites-enabled/

# Nginx è¨­å®šãƒ†ã‚¹ãƒˆ
sudo nginx -t

# Nginx å†èµ·å‹•
sudo systemctl restart nginx
```

**Step 4: Let's Encrypt è¨¼æ˜æ›¸å–å¾—**

```bash
# è¨¼æ˜æ›¸å–å¾—ï¼ˆNginx ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½¿ç”¨ï¼‰
sudo certbot --nginx -d resonant-engine.com -d api.resonant-engine.com

# ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›
# åˆ©ç”¨è¦ç´„åŒæ„

# è¨¼æ˜æ›¸è‡ªå‹•æ›´æ–°ç¢ºèª
sudo certbot renew --dry-run
```

**Step 5: HTTPS æ¥ç¶šç¢ºèª**

```bash
# ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª
https://resonant-engine.com
https://api.resonant-engine.com/docs
```

#### 5.2.3 systemd ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š

**Step 1: ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**

```bash
sudo nano /etc/systemd/system/resonant-engine.service
```

**/etc/systemd/system/resonant-engine.service**:

```ini
[Unit]
Description=Resonant Engine Docker Compose
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/home/ubuntu/resonant-engine/docker
ExecStart=/usr/bin/docker compose -f docker-compose.production.yml up -d
ExecStop=/usr/bin/docker compose -f docker-compose.production.yml down
User=ubuntu

[Install]
WantedBy=multi-user.target
```

**Step 2: ã‚µãƒ¼ãƒ“ã‚¹æœ‰åŠ¹åŒ–**

```bash
# ã‚µãƒ¼ãƒ“ã‚¹æœ‰åŠ¹åŒ–
sudo systemctl enable resonant-engine

# ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
sudo systemctl start resonant-engine

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
sudo systemctl status resonant-engine
```

#### 5.2.4 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—ï¼†DNSè¨­å®šå®Œäº†
- [ ] Let's Encrypt SSLè¨¼æ˜æ›¸å–å¾—å®Œäº†
- [ ] Nginx ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·è¨­å®šå®Œäº†
- [ ] HTTPSæ¥ç¶šç¢ºèªå®Œäº†
- [ ] systemd ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šå®Œäº†
- [ ] Sprint 5 å®Œå…¨å®Œäº† âœ…

---

## 6. Claude API çµ±åˆæ¤œè¨¼

**æœŸé–“**: 3æ—¥
**å„ªå…ˆåº¦**: A

### 6.1 Day 1: Backend â†’ Claude API çµ±åˆå®Ÿè£…

#### 6.1.1 ä½œæ¥­æ‰‹é †

**Step 1: ClaudeBridge æ‹¡å¼µ**

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†
nano bridge/providers/ai/claude_bridge.py
```

**å®Ÿè£…å†…å®¹**: ä»•æ§˜æ›¸ã®5.3.1å‚ç…§

**Step 2: ãƒ†ã‚¹ãƒˆå®Ÿè£…**

```bash
touch tests/integration/test_claude_api.py
```

**å®Ÿè£…å†…å®¹**: ä»•æ§˜æ›¸ã®5.3.2å‚ç…§

**Step 3: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**

```bash
# API ã‚­ãƒ¼è¨­å®š
export ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/integration/test_claude_api.py -v
```

**Step 4: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add bridge/providers/ai/claude_bridge.py tests/integration/test_claude_api.py
git commit -m "feat(ai): Add Claude API integration for Intent processing

- Implement process_intent method
- Add prompt construction logic
- Add token usage tracking
- Add response caching (15min TTL)
- Add integration tests

Claude API integration: Phase 1 completed"
```

#### 6.1.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ClaudeBridge æ‹¡å¼µå®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè£…å®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆ PASS
- [ ] ã‚³ãƒŸãƒƒãƒˆå®Œäº†

---

### 6.2 Day 2: Token ä½¿ç”¨é‡è¿½è·¡ï¼†ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š

#### 6.2.1 ä½œæ¥­æ‰‹é †

**Step 1: token_usage ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ**

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
touch docker/postgres/003_token_usage.sql
```

**docker/postgres/003_token_usage.sql**:

```sql
-- Tokenä½¿ç”¨é‡è¿½è·¡ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE IF NOT EXISTS token_usage (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    timestamp TIMESTAMP NOT NULL DEFAULT NOW(),
    intent_id UUID REFERENCES intents(id),
    model VARCHAR(100) NOT NULL,
    prompt_tokens INTEGER NOT NULL,
    completion_tokens INTEGER NOT NULL,
    total_tokens INTEGER NOT NULL,
    total_cost_usd NUMERIC(10, 6) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_token_usage_timestamp ON token_usage(timestamp);
CREATE INDEX idx_token_usage_intent_id ON token_usage(intent_id);
```

**Step 2: ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡è¨˜éŒ²å®Ÿè£…**

`bridge/providers/ai/claude_bridge.py` ã«å®Ÿè£…ï¼ˆä»•æ§˜æ›¸å‚ç…§ï¼‰

**Step 3: ã‚³ã‚¹ãƒˆé›†è¨ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ**

```bash
touch scripts/calculate_token_cost.py
```

**scripts/calculate_token_cost.py**:

```python
"""ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ï¼†ã‚³ã‚¹ãƒˆé›†è¨ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ"""
import asyncio
import asyncpg
from datetime import datetime, timedelta

async def calculate_monthly_cost():
    """æœˆé–“ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ï¼†ã‚³ã‚¹ãƒˆé›†è¨ˆ"""

    conn = await asyncpg.connect(dsn="postgresql://resonant:password@localhost:5432/resonant")

    # ä»Šæœˆã®ãƒ‡ãƒ¼ã‚¿å–å¾—
    today = datetime.now()
    first_day = today.replace(day=1, hour=0, minute=0, second=0, microsecond=0)

    result = await conn.fetchrow("""
        SELECT
            SUM(prompt_tokens) as total_prompt_tokens,
            SUM(completion_tokens) as total_completion_tokens,
            SUM(total_tokens) as total_tokens,
            SUM(total_cost_usd) as total_cost
        FROM token_usage
        WHERE timestamp >= $1
    """, first_day)

    print(f"ğŸ“Š Monthly Token Usage ({today.strftime('%Y-%m')})")
    print(f"  Prompt Tokens: {result['total_prompt_tokens']:,}")
    print(f"  Completion Tokens: {result['total_completion_tokens']:,}")
    print(f"  Total Tokens: {result['total_tokens']:,}")
    print(f"  Total Cost: ${result['total_cost']:.2f}")

    await conn.close()

if __name__ == '__main__':
    asyncio.run(calculate_monthly_cost())
```

**Step 4: å®Ÿè¡Œï¼†ç¢ºèª**

```bash
cd /Users/zero/Projects/resonant-engine/ && \
source venv/bin/activate && \
python scripts/calculate_token_cost.py
```

**Step 5: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add docker/postgres/003_token_usage.sql scripts/calculate_token_cost.py
git commit -m "feat(ai): Add token usage tracking and cost calculation

- Create token_usage table
- Implement token usage recording
- Add monthly cost calculation script
- Add cost monitoring

Claude API integration: Phase 2 completed"
```

#### 6.2.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] token_usage ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆå®Œäº†
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³è¨˜éŒ²å®Ÿè£…å®Œäº†
- [ ] ã‚³ã‚¹ãƒˆé›†è¨ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆå®Œäº†
- [ ] ã‚³ãƒŸãƒƒãƒˆå®Œäº†

---

### 6.3 Day 3: ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ï¼†æœ€çµ‚æ¤œè¨¼

#### 6.3.1 ä½œæ¥­æ‰‹é †

**Step 1: Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥å°å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**

ç°¡æ˜“å®Ÿè£…ã§ã¯ Python ã® `cachetools` ã‚’ä½¿ç”¨ã€‚

```bash
pip install cachetools
```

**Step 2: ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°å®Ÿè£…**

`bridge/providers/ai/claude_bridge.py` ã«è¿½åŠ ï¼ˆä»•æ§˜æ›¸å‚ç…§ï¼‰

**Step 3: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡è¨ˆæ¸¬**

```python
# ClaudeBridge ã‚¯ãƒ©ã‚¹ã«è¿½åŠ 
@property
def cache_hit_rate(self):
    """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡"""
    total = self.metrics['cache_hits'] + self.metrics['cache_misses']
    if total == 0:
        return 0.0
    return (self.metrics['cache_hits'] / total) * 100
```

**Step 4: æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆ**

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/integration/test_claude_api.py -v

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ç¢ºèª
# â†’ ãƒ†ã‚¹ãƒˆãƒ­ã‚°ã«å‡ºåŠ›
```

**Step 5: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add bridge/providers/ai/claude_bridge.py
git commit -m "feat(ai): Add response caching with 15min TTL

- Implement cachetools-based caching
- Add cache hit rate tracking
- Optimize API call frequency
- Add cache hit rate property

Claude API integration: Phase 3 completed âœ…"
```

#### 6.3.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°å®Ÿè£…å®Œäº†
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡è¨ˆæ¸¬å®Œäº†
- [ ] æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆ PASS
- [ ] Claude API çµ±åˆæ¤œè¨¼å®Œå…¨å®Œäº† âœ…

---

## 7. Kana å®Ÿè£… Phase 1

**æœŸé–“**: 2é€±é–“
**å„ªå…ˆåº¦**: B

### 7.1 Week 1: ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£…

#### 7.1.1 ä½œæ¥­æ‰‹é †

**Step 1: Kana ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ**

```bash
mkdir -p bridge/kana
touch bridge/kana/__init__.py
touch bridge/kana/translator.py
touch bridge/kana/auditor.py
touch bridge/kana/consistency_checker.py
touch bridge/kana/report_generator.py
```

**Step 2: ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£…**

**bridge/kana/translator.py**:

ä»•æ§˜æ›¸ã®4.3.3å‚ç…§

**Step 3: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ**

```bash
mkdir -p bridge/kana/prompts
touch bridge/kana/prompts/translate_to_schema.txt
touch bridge/kana/prompts/translate_to_api.txt
touch bridge/kana/prompts/check_consistency.txt
```

**Step 4: ãƒ†ã‚¹ãƒˆå®Ÿè£…**

```bash
mkdir -p tests/kana
touch tests/kana/test_translator.py
```

**tests/kana/test_translator.py**:

```python
"""Kana ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ"""
import pytest
from bridge.kana.translator import KanaTranslator

@pytest.mark.asyncio
class TestKanaTranslator:
    """Kana ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ"""

    async def test_translate_yuno_to_schema(self, translator):
        """Yunoæ€æƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ â†’ PostgreSQL ã‚¹ã‚­ãƒ¼ãƒç¿»è¨³"""

        # Yuno ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¹
        yuno_doc = "docs/07_philosophy/yuno_documents/emotion_resonance_filter_detailed.md"

        # ç¿»è¨³å®Ÿè¡Œ
        schema_sql = await translator.translate_to_schema(yuno_doc)

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
        assert schema_sql is not None
        assert "CREATE TABLE" in schema_sql
        assert "emotion_resonance" in schema_sql.lower()

    async def test_translate_yuno_to_fastapi(self, translator):
        """Yunoæ€æƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ â†’ FastAPI ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¿»è¨³"""

        yuno_doc = "docs/07_philosophy/yuno_documents/crisis_index_detailed.md"

        # ç¿»è¨³å®Ÿè¡Œ
        fastapi_code = await translator.translate_to_fastapi(yuno_doc)

        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
        assert fastapi_code is not None
        assert "@router.get" in fastapi_code or "@router.post" in fastapi_code
        assert "crisis_index" in fastapi_code.lower()
```

**Step 5: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add bridge/kana/ tests/kana/
git commit -m "feat(kana): Implement translation engine (Phase 1)

- Add KanaTranslator class
- Implement translate_to_schema method
- Implement translate_to_fastapi method
- Add system prompt templates
- Add unit tests

Kana implementation: 20% completed"
```

#### 7.1.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Kana ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆå®Œäº†
- [ ] ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£…å®Œäº†
- [ ] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆå®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè£…å®Œäº†
- [ ] ã‚³ãƒŸãƒƒãƒˆå®Œäº†

---

### 7.2 Week 2: è¨­è¨ˆç›£æŸ»ï¼†æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯

#### 7.2.1 ä½œæ¥­æ‰‹é †

**Step 1: Auditor å®Ÿè£…**

**bridge/kana/auditor.py**:

ä»•æ§˜æ›¸ã®4.3.3å‚ç…§

**Step 2: ConsistencyChecker å®Ÿè£…**

**bridge/kana/consistency_checker.py**:

```python
"""æ•´åˆæ€§ãƒã‚§ãƒƒã‚«ãƒ¼"""
from typing import List, Dict

class ConsistencyChecker:
    """Yunoæ€æƒ³ã¨ç”Ÿæˆä»•æ§˜ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯"""

    async def check_scope_alignment(self, generated_spec: str, yuno_doc: str) -> List[str]:
        """ã‚¹ã‚³ãƒ¼ãƒ—æ•´åˆç¢ºèªï¼ˆL1/L2/L3ï¼‰"""

        issues = []

        # L3ï¼ˆå…¨ä½“åŸå‰‡ï¼‰ãƒã‚§ãƒƒã‚¯
        if "å‘¼å¸" not in yuno_doc and "breath" not in generated_spec.lower():
            issues.append("L3: Missing breath concept in generated spec")

        # L2ï¼ˆæ¨ªæ–­ï¼‰ãƒã‚§ãƒƒã‚¯
        if "å…±é³´" in yuno_doc and "resonance" not in generated_spec.lower():
            issues.append("L2: Missing resonance concept")

        # L1ï¼ˆå±€æ‰€ï¼‰ãƒã‚§ãƒƒã‚¯
        # TODO: å…·ä½“çš„ãªãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯

        return issues

    async def check_terminology_consistency(self, generated_spec: str, yuno_doc: str) -> List[str]:
        """ç”¨èªã®ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯"""

        issues = []

        # Yunoç”¨èªãƒãƒƒãƒ”ãƒ³ã‚°
        yuno_terms = {
            "ERF": "Emotion Resonance Filter",
            "Crisis Index": "å±æ©ŸæŒ‡æ•°",
            "Re-evaluation": "èªè­˜å†è©•ä¾¡"
        }

        for term, definition in yuno_terms.items():
            if term in yuno_doc and term not in generated_spec:
                issues.append(f"Terminology: Missing '{term}' in generated spec")

        return issues
```

**Step 3: ãƒ†ã‚¹ãƒˆå®Ÿè£…**

```bash
touch tests/kana/test_auditor.py
touch tests/kana/test_consistency_checker.py
```

**Step 4: çµ±åˆãƒ†ã‚¹ãƒˆ**

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/kana/ -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸
pytest tests/kana/ --cov=bridge.kana --cov-report=html
```

**Step 5: ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add bridge/kana/ tests/kana/
git commit -m "feat(kana): Implement auditor and consistency checker (Phase 2)

- Add KanaAuditor class
- Add ConsistencyChecker class
- Implement scope alignment check (L1/L2/L3)
- Implement terminology consistency check
- Add comprehensive tests

Kana implementation: 50% completed âœ…"
```

#### 7.2.2 å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Auditor å®Ÿè£…å®Œäº†
- [ ] ConsistencyChecker å®Ÿè£…å®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè£…å®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 80%ä»¥ä¸Š
- [ ] Kana Phase 1 å®Œå…¨å®Œäº† âœ…

---

## 8. æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### 8.1 æ¯æœã®ä½œæ¥­é–‹å§‹æ™‚

```bash
# 1. ç’°å¢ƒç¢ºèª
cd /Users/zero/Projects/resonant-engine/
source venv/bin/activate

# 2. Git æœ€æ–°åŒ–
git fetch origin
git pull origin claude/analyze-project-status-01BUzZJHdAkse1LvZwQU7a3B

# 3. Docker ç’°å¢ƒèµ·å‹•
cd docker && ./scripts/start.sh

# 4. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
./scripts/check-health.sh

# 5. æœ¬æ—¥ã®ã‚¿ã‚¹ã‚¯ç¢ºèª
cat docs/work_instructions/next_phase_work_instruction.md
```

### 8.2 ä½œæ¥­ä¸­

- [ ] ã“ã¾ã‚ã«ã‚³ãƒŸãƒƒãƒˆï¼ˆæ©Ÿèƒ½å˜ä½ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå¤‰æ›´æ¯ï¼‰
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

### 8.3 æ¯å¤•ã®ä½œæ¥­çµ‚äº†æ™‚

```bash
# 1. å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/ -v

# 2. ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
pytest --cov=bridge --cov-report=term

# 3. ã‚³ãƒŸãƒƒãƒˆç¢ºèª
git status
git log --oneline -5

# 4. ãƒ—ãƒƒã‚·ãƒ¥
git push -u origin <current-branch>

# 5. é€²æ—è¨˜éŒ²
# â†’ ä½œæ¥­ãƒ­ã‚°ã«è¨˜éŒ²
```

---

## 9. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 9.1 Docker èµ·å‹•å¤±æ•—

**ç—‡çŠ¶**: `docker compose up` ãŒã‚¨ãƒ©ãƒ¼

**å¯¾å‡¦**:
```bash
# ãƒ­ã‚°ç¢ºèª
docker compose logs

# ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤ï¼†å†èµ·å‹•
docker compose down -v
docker compose up --build -d
```

### 9.2 ãƒ†ã‚¹ãƒˆå¤±æ•—

**ç—‡çŠ¶**: pytest ãŒã‚¨ãƒ©ãƒ¼

**å¯¾å‡¦**:
```bash
# è©³ç´°ãƒ­ã‚°ç¢ºèª
pytest -v -s

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
pytest tests/concurrency/test_deadlock_retry.py::TestDeadlockRetry::test_deadlock_auto_retry_success -v
```

### 9.3 PostgreSQL æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `connection refused`

**å¯¾å‡¦**:
```bash
# PostgreSQL èµ·å‹•ç¢ºèª
docker compose ps

# PostgreSQL ãƒ­ã‚°ç¢ºèª
docker compose logs db

# æ¥ç¶šãƒ†ã‚¹ãƒˆ
docker compose exec db psql -U resonant -d resonant -c "SELECT 1"
```

---

## 10. å®Œäº†å ±å‘Š

å…¨ä½œæ¥­å®Œäº†å¾Œã€ä»¥ä¸‹ã‚’å®Ÿæ–½ï¼š

1. **æœ€çµ‚ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
```bash
pytest tests/ -v --cov=bridge --cov-report=html
```

2. **å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆå®Ÿæ–½**
ï¼ˆå—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã«å¾“ã†ï¼‰

3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæœ€çµ‚ç¢ºèª**

4. **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ**
```bash
gh pr create --title "Complete Sprint 2-5 and Kana Phase 1" --body "$(cat docs/reports/completion_report.md)"
```

5. **å®å•“ã•ã‚“ã«å ±å‘Š**

---

**ä½œæ¥­é–‹å§‹æŒ‡ç¤ºæ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0
**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ18æ—¥
**æ‰¿èª**: åŠ è—¤å®å•“ï¼ˆHiroaki Katoï¼‰
