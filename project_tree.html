<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Resonant Engine - Project Tree</title>
<style>
  :root { 
    --bg:#0f1115; 
    --fg:#e6e6e6; 
    --muted:#9aa0a6; 
    --accent:#4c8bf5; 
    --chip:#1b1f2a; 
    --border:#2a2f3a; 
  }
  html,body{height:100%; margin:0; padding:0;}
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic UI", "Meiryo", Arial, sans-serif;
    background:var(--bg); 
    color:var(--fg);
    display:flex; 
    flex-direction:column;
  }
  header{
    padding:16px 20px; 
    border-bottom:1px solid var(--border);
    display:flex; 
    gap:12px; 
    flex-wrap:wrap; 
    align-items:center; 
    justify-content:space-between;
    background:var(--bg);
    position:sticky;
    top:0;
    z-index:100;
  }
  .left, .right{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
  h1{font-size:18px; margin:0; color:#fff; letter-spacing:.2px; font-weight:600;}
  input[type="text"]{
    width:280px; 
    max-width:55vw; 
    padding:10px 12px; 
    border-radius:8px; 
    border:1px solid var(--border); 
    background:#0b0d12; 
    color:var(--fg); 
    outline:none;
    font-size:14px;
  }
  input[type="text"]::placeholder{color:var(--muted);}
  input[type="text"]:focus{
    border-color:var(--accent);
    box-shadow:0 0 0 3px rgba(76, 139, 245, 0.1);
  }
  button{
    border:1px solid var(--border); 
    background:#121722; 
    color:var(--fg); 
    padding:10px 16px; 
    border-radius:8px; 
    cursor:pointer;
    font-size:14px;
    transition:background 0.2s;
  }
  button:hover{background:#171c28;}
  button:active{background:#0f1419;}
  .pill{
    padding:8px 12px; 
    border-radius:999px; 
    background:var(--chip); 
    border:1px solid var(--border); 
    color:var(--muted); 
    font-size:12px;
    display:inline-flex;
    align-items:center;
    gap:6px;
  }
  .pill input[type="checkbox"]{
    margin:0;
    cursor:pointer;
  }
  #tree{
    padding:20px;
    flex:1;
    overflow-y:auto;
  }
  ul.tree{
    list-style:none; 
    padding-left:20px; 
    margin:0;
  }
  li.item{
    margin:4px 0; 
    position:relative; 
    padding-left:24px;
    line-height:1.6;
  }
  li.item .twist{
    position:absolute; 
    left:0; 
    top:2px; 
    width:20px; 
    height:20px; 
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size:14px; 
    color:var(--muted); 
    cursor:pointer; 
    user-select:none;
    transition:color 0.2s;
  }
  li.item .twist:hover{
    color:var(--accent);
  }
  li.item.file .twist{
    opacity:.4; 
    cursor:default;
  }
  li.item.file .twist:hover{
    color:var(--muted);
  }
  li.item .name{
    cursor:default;
    user-select:text;
  }
  li.item.dir > .name{
    cursor:pointer;
    color:#e6e6e6;
    font-weight:500;
  }
  li.item.file > .name{
    color:var(--muted);
  }
  li.item .name mark{
    background:transparent; 
    color:#ffd479; 
    font-weight:600;
  }
  li.item.collapsed > ul{
    display:none;
  }
  .counts{
    margin-left:6px; 
    color:var(--muted); 
    font-size:13px;
  }
  footer{
    padding:14px 20px; 
    border-top:1px solid var(--border);
    background:var(--bg);
  }
  .hint{
    color:var(--muted); 
    font-size:12px;
    line-height:1.6;
  }
  .kbd{
    border:1px solid var(--border); 
    background:#0b0d12; 
    padding:2px 6px; 
    border-radius:4px; 
    font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; 
    font-size:11px;
  }
  .hidden{display:none!important;}
  
  /* スクロールバーのスタイル */
  #tree::-webkit-scrollbar {
    width: 10px;
  }
  #tree::-webkit-scrollbar-track {
    background: var(--bg);
  }
  #tree::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 5px;
  }
  #tree::-webkit-scrollbar-thumb:hover {
    background: var(--muted);
  }
</style>
</head>
<body>
  <header>
    <div class="left">
      <h1>Resonant Engine - Project Tree</h1>
      <span class="counts" id="counts">—</span>
    </div>
    <div class="right">
      <input id="q" type="text" placeholder="検索（ファイル/フォルダ名）… / でフォーカス">
      <button id="expandAll">すべて展開</button>
      <button id="collapseAll">すべて折りたたみ</button>
      <label class="pill">
        <input id="toggleFiles" type="checkbox" checked>
        <span>ファイルも表示</span>
      </label>
    </div>
  </header>

  <div id="tree"></div>

  <footer>
    <div class="hint">
      <b>使い方：</b> クリックで折りたたみ/展開 | <span class="kbd">E</span>で展開 / <span class="kbd">C</span>で折りたたみ / <span class="kbd">/</span>で検索 | 検索はハイライト＆一致ノードまで自動展開
    </div>
  </footer>

<script>
// ---------- Utilities ----------
function byId(id){return document.getElementById(id)}
const out = byId('tree');
const q = byId('q');
const expandBtn = byId('expandAll');
const collapseBtn = byId('collapseAll');
const toggleFiles = byId('toggleFiles');
const countsEl = byId('counts');

// project_tree.txtの内容
const treeText = `.
├── .cursorrules
├── .env
├── .env.template
├── .gitignore
├── README.md
├── archive_legacy
│   ├── agents
│   ├── cloudflare
├── bridge
│   ├── daemon_config.json
│   ├── intent_protocol.json
│   ├── intent_protocol.json.bak_20251029_171217
│   └── semantic_signal.log
├── daemon
│   ├── README.md
│   ├── __init__.py
│   ├── auto_reflect.sh
│   ├── config
│   │   └── config.yaml
│   ├── feedback_agent.py
│   ├── hypothesis_trace.py
│   ├── hypothesis_trace_log.jsonl
│   ├── intent_watcher.sh
│   ├── log_archiver.py
│   ├── logs
│   │   ├── archive_journal.jsonl
│   │   ├── hypothesis_trace_log.json
│   │   ├── last_commit.txt
│   │   ├── observer_daemon.log
│   │   └── reflect_activity.log
│   ├── nohup.out
│   ├── observer_daemon.py
│   ├── pids
│   │   └── observer_daemon.lock
│   ├── resonant_analyzer.py
│   ├── resonant_bridge_daemon.sh
│   ├── resonant_daemon.py
│   ├── resonant_daemon_bridge.sh
│   ├── resonant_io_watcher.sh
│   ├── start_daemon.sh
│   ├── test_reflect.txt
│   ├── test_signal.txt
│   └── test_touch.txt
├── dashboard
│   └── backend
│       └── intent_processor.py
├── dependency_map.txt
├── docs
│   ├── Phase0
│   │   ├── p0_improvement_completion_report.md
│   │   ├── p0_improvement_guide.md
│   │   ├── p0_improvement_review_request.md
│   │   ├── p0_improvement_review_response.md
│   │   └── p0_improvement_review_result_yuno.md
│   ├── Phase1
│   │   └── p1_improvement_completion_report.md
│   ├── Phase2
│   │   ├── p2_improvement_completion_report.md
│   │   ├── p2_improvement_design_spec.md
│   │   ├── p2_improvement_final_review_report.md
│   │   ├── p2_improvement_implementation_guide.md
│   │   └── p2_improvement_review_report.md
│   ├── Phase3
│   │   ├── phase3_basic_design.md
│   │   ├── phase3_completion_report.md
│   │   ├── phase3_detailed_design.md
│   │   ├── phase3_review_report.md
│   │   ├── phase3_review_request.md
│   │   └── phase3_review_response.md
│   ├── Yuno
│   │   ├── crisis_index_detailed.md
│   │   ├── emotion_resonance_filter_detailed.md
│   │   ├── erf_resonant_detection_quantification.md
│   │   ├── intent_bridge_design_note.md
│   │   ├── notion_integration_history.md
│   │   ├── re_evaluation_phase_detailed.md
│   │   ├── resonant_daily_framework_detailed.md
│   │   ├── resonant_feedback_loop_detailed.md
│   │   ├── resonant_four_layer_architecture.md
│   │   ├── resonant_operational_regulations_full.md
│   │   ├── resonant_scope_alignment_detailed.md
│   │   ├── review_yuno_implementation_roadmap_postgres.md
│   │   ├── review_yuno_priority2_postgres_plan.md
│   │   ├── the_hiroaki_model_phases_detailed.md
│   │   ├── the_hiroaki_model_resonant_intelligence_extension.md
│   │   ├── yuno_claude_review_response.md
│   │   ├── yuno_resonant_conduct_principles.md
│   │   ├── yuno_response_to_claude_inquiry.md
│   │   └── yuno_self_rumination_overview.md
│   ├── architecture
│   │   └── kiro_v3.1_architecture.md
│   ├── canvas
│   ├── cloud_migration_strategy.md
│   ├── complete_architecture_design.md
│   ├── create_resonant_total_archive.py
│   ├── create_resonant_total_chronicle_v4_raw.py
│   ├── create_resonant_total_chronicle_v5_expanded.py
│   ├── dashboard_platform_design.md
│   ├── design
│   ├── env_template.txt
│   ├── error_recovery_basic_design.md
│   ├── error_recovery_detailed_design.md
│   ├── error_recovery_implementation.md
│   ├── error_recovery_review_request.md
│   ├── error_recovery_review_response.md
│   ├── error_recovery_test_results.md
│   ├── history
│   │   └── dir_restructure_commit.log
│   ├── html
│   │   └── github_webhook_receiver_spec.html
│   ├── implementation_roadmap_postgres.md
│   ├── index.html
│   ├── integration_complete.md
│   ├── integration_design.md
│   ├── notion_integration_summary.md
│   ├── notion_setup_guide.md
│   ├── output
│   │   ├── cloude_chat.md
│   │   ├── current_agent_memory_structure.md
│   │   ├── resonant_total_architecture_yuno_hiroaki_full_2025-11-07.md
│   │   ├── resonant_total_chronicle_v5_expanded.md
│   │   ├── resonant_total_chronicle_yuno_hiroaki_full_2025-11-07.md
│   │   └── resonant_total_chronicle_yuno_hiroaki_full_raw_2025-11-07.md
│   ├── persistence_check.log
│   ├── phase3_test.txt
│   ├── phase3_work_summary.md
│   ├── priority2_postgres_plan.md
│   ├── quick_start_unified_stream.md
│   ├── report_template.md
│   ├── resonant_total_chronicle_v5_expanded.md
│   ├── setup
│   │   └── validation_checklist.md
│   ├── specs
│   ├── templates
│   ├── update_docs_index.py
│   └── update_docs_index_README.md
├── logs
│   ├── all_python_files_20251103.log
│   ├── all_shell_files_20251103.log
│   ├── analyzer.log
│   ├── auto_sync.log
│   ├── code_snapshot
│   │   ├── python_snapshot_20251103.log
│   │   └── shell_snapshot_20251103.log
│   ├── daemon.log
│   ├── daemon_bridge.log
│   ├── dead_letter_queue.jsonl
│   ├── delivery_cache.json
│   ├── event_stream.jsonl
│   ├── feedback_agent.log
│   ├── function_daemon_mapping_v2.md
│   ├── handover_summary.md
│   ├── intent_log.jsonl
│   ├── intent_processor.log
│   ├── kana_responses.log
│   ├── metrics.json
│   ├── module_structure_20251103.log
│   ├── proof_channel.log
│   ├── resonant_state.log
│   ├── reval_bridge.log
│   ├── session_2025-11-08_1900-1935.md
│   ├── telemetry_feedback.log
│   ├── telemetry_report.json
│   ├── trace_auto.log
│   ├── trace_map.jsonl
│   ├── watcher.log
│   ├── webhook.log
│   └── webhook_log.jsonl
├── module_structure_report.txt
├── project_tree.txt
├── reports
│   ├── report_20251102_1039.md
│   ├── report_20251102_1042.md
│   ├── report_20251102_1044.md
│   └── report_20251102_1051.md
├── requirements.txt
├── scripts
│   ├── auto_sync_phase3.sh
│   ├── cleanup_phase1.sh
│   ├── end_dev.sh
│   ├── make_overview.sh
│   ├── make_report.sh
│   ├── notion_archive_push.sh
│   ├── reflection_verification.sh
│   ├── resonant_watcher.sh
│   ├── reval_bridge.sh
│   ├── setup_env.sh
│   ├── start_dev.sh
│   ├── telemetry_feedback_loop.sh
│   ├── test_input_from_mac.txt
│   ├── test_output_from_proof.txt
│   └── test_resonant_output.txt
├── test_intent_processor.py
├── tests
│   └── test_retry_strategy.py
├── utils
│   ├── backlog_sync_agent.py
│   ├── context_api.py
│   ├── create_notion_databases.py
│   ├── error_recovery.py
│   ├── error_recovery_cli.py
│   ├── github_webhook_receiver.py
│   ├── intent_logger.py
│   ├── metrics_collector.py
│   ├── notion_sync_agent.py
│   ├── record_intent.py
│   ├── rename_notion_databases.py
│   ├── resilient_event_stream.py
│   ├── resonant_digest.py
│   ├── resonant_event_stream.py
│   ├── retry_strategy.py
│   ├── trace_auto.sh
│   ├── trace_events.py
│   └── trace_linker.py`;

function normalizeLine(line){
  const replaced = line
    .replace(/[│]/g, '│')
    .replace(/├──|└──/g, '')
    .replace(/\s+$/,'');
  return replaced;
}

function depthOf(line){
  let i=0, depth=0;
  while(i < line.length){
    if(line.startsWith('    ', i)){ depth++; i+=4; continue; }
    if(line.startsWith('│   ', i)){ depth++; i+=4; continue; }
    if(line[i]===' ' || line[i]==='│'){ i++; continue; }
    break;
  }
  return depth;
}

function visibleName(line){
  return line.replace(/^[\s│]+/, '').replace(/^[├└]──\s*/, '').trim();
}

function isProbablyDir(name){
  if(name === '.' || name === '..') return true;
  if(name.endsWith('/')) return true;
  const base = name.split('/').pop();
  return !base.includes('.');
}

function parseTreeText(text){
  const lines = text.split(/\r?\n/).filter(l => l.trim().length>0);
  const root = { name: 'resonant-engine', children: [], dir:true };
  const stack = [ { node: root, depth: -1 } ];

  for(const raw of lines){
    const line = normalizeLine(raw);
    const d = depthOf(line);
    const name = visibleName(line);
    if(!name) continue;
    
    // Skip root '.' line
    if(name === '.' && d === 0) continue;

    const node = { name, children: [], dir: isProbablyDir(name) };

    while(stack.length && stack[stack.length-1].depth >= d){
      stack.pop();
    }
    stack[stack.length-1].node.children.push(node);
    stack.push({ node, depth: d });
  }
  return root;
}

function buildList(node, { filter='', showFiles=true }){
  const ul = document.createElement('ul');
  ul.className = 'tree';

  function matches(name){
    return filter ? name.toLowerCase().includes(filter.toLowerCase()) : true;
  }

  function dfs(n){
    if(n === rootModel) {
      n.children.forEach(dfs);
      return;
    }
    if(!n.dir && !showFiles) return;
    const li = document.createElement('li');
    li.className = 'item ' + (n.dir ? 'dir' : 'file');

    const twist = document.createElement('span');
    twist.className = 'twist';
    twist.textContent = n.dir ? '▸' : '•';

    const nameEl = document.createElement('span');
    nameEl.className = 'name';
    nameEl.textContent = n.name;

    if(filter && matches(n.name)){
      const idx = n.name.toLowerCase().indexOf(filter.toLowerCase());
      if(idx >= 0){
        const before = n.name.slice(0, idx);
        const mid = n.name.slice(idx, idx+filter.length);
        const after = n.name.slice(idx+filter.length);
        nameEl.innerHTML = `${escapeHtml(before)}<mark>${escapeHtml(mid)}</mark>${escapeHtml(after)}`;
      }
    }

    if(n.dir){
      li.appendChild(twist);
      li.appendChild(nameEl);
      const childUl = document.createElement('ul');
      childUl.className = 'tree';
      n.children.forEach(c => {
        const childLi = dfs(c);
        if(childLi) childUl.appendChild(childLi);
      });
      li.appendChild(childUl);
      li.classList.remove('collapsed');
      twist.addEventListener('click', () => toggle(li));
      nameEl.addEventListener('click', () => toggle(li));
    }else{
      li.appendChild(twist);
      li.appendChild(nameEl);
    }

    if(filter){
      const selfMatch = matches(n.name);
      const descMatch = !!li.querySelector('mark');
      if(!selfMatch && !descMatch && !n.dir) return null;
      if(n.dir && (selfMatch || descMatch)) li.classList.remove('collapsed');
    }

    return li;
  }

  function toggle(li){
    const isCollapsed = li.classList.toggle('collapsed');
    const twist = li.querySelector('.twist');
    if(!twist) return;
    twist.textContent = isCollapsed ? '▸' : '▾';
  }

  function escapeHtml(s){
    return s.replace(/[&<>"']/g, c => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[c]));
  }

  const frag = document.createDocumentFragment();
  const liList = [];
  rootModel.children.forEach(c => {
    const li = dfs(c);
    if(li) liList.push(li);
  });
  liList.forEach(li => frag.appendChild(li));
  ul.appendChild(frag);
  return ul;
}

// ---------- UI State ----------
let rootModel = { name:'resonant-engine', dir:true, children:[] };

function render(){
  out.innerHTML = '';
  const filter = q.value.trim();
  const showFiles = toggleFiles.checked;
  const ul = buildList(rootModel, { filter, showFiles });
  out.appendChild(ul);
  updateCounts();
  out.querySelectorAll('li.item.dir').forEach(li => {
    const twist = li.querySelector('.twist'); 
    if(!twist) return;
    const collapsed = li.classList.contains('collapsed');
    twist.textContent = collapsed ? '▸' : '▾';
  });
}

function updateCounts(){
  const totalDirs = countBy(n => n.dir);
  const totalFiles = countBy(n => !n.dir);
  countsEl.textContent = `フォルダ ${totalDirs}・ファイル ${totalFiles}`;
}

function countBy(pred){
  let cnt=0;
  (function walk(n){
    if(n!==rootModel && pred(n)) cnt++;
    n.children?.forEach(walk);
  })(rootModel);
  return cnt;
}

function setFromText(text){
  rootModel = parseTreeText(text);
  render();
}

// ---------- Interactions ----------
expandBtn.addEventListener('click', () => {
  out.querySelectorAll('li.item.dir').forEach(li => li.classList.remove('collapsed'));
  out.querySelectorAll('li.item.dir .twist').forEach(t => t.textContent='▾');
});

collapseBtn.addEventListener('click', () => {
  out.querySelectorAll('li.item.dir').forEach(li => li.classList.add('collapsed'));
  out.querySelectorAll('li.item.dir .twist').forEach(t => t.textContent='▸');
});

toggleFiles.addEventListener('change', render);

q.addEventListener('input', render);
q.addEventListener('keydown', (e)=>{
  if(e.key==='Escape'){ q.value=''; render(); }
});

window.addEventListener('keydown', (e)=>{
  if(e.key==='/'){ 
    e.preventDefault(); 
    q.focus(); 
    q.select(); 
  }
  if(e.key==='e' || e.key==='E'){ expandBtn.click(); }
  if(e.key==='c' || e.key==='C'){ collapseBtn.click(); }
});

// Initialize
setFromText(treeText);
</script>
</body>
</html>
